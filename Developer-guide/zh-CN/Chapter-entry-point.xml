<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Developer-guide.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-EayunOS-Developer-guide-entry-points_Chapter">
   <title>第五章 入口点</title>
   <para>
      
   </para>
   <section id="sect-EayunOS-Developer-guide-entry-points_Chapter-entry-points_Section_1">
      <title>访问API入口点</title>
      <para>
            用户通过由host和base组成的入口点url发送一个GET方法的请求，以此开始和API进行交互。
      </para>
      <example>
         <title>engine-manage-domains的add操作</title>
         <para>
            如果<emphasis>host</emphasis>是<emphasis>www.example.com</emphasis>而且<emphasis>base</emphasis>是<emphasis>/api</emphasis>,入口切入点会伴随着以下请求出现：
         </para>
         <para>
         <programlisting>
         <![CDATA[
 GET /api HTTP/1.1
 Accept: application/xml
 Host: www.example.com      
 Authorization: [base64 encoded credentials]

 HTTP/1.1 200 OK
 Content-Type: application/xml
 <api>
 <link rel="hosts" href="/api/hosts"/>
 <link rel="vms" href="/api/vms"/>
    ...
    <product_info>
       <name>Red Hat Enterprise Virtualization</name>
       <vendor>Red Hat</vendor>
       <version revision="0" build="0" minor="1" major="3"/>
    </product_info>    
    <special_objects>
       <link rel="templates/blank" href="..."/>
       <link rel="tags/root" href="..."/>
    </special_objects>
    <summary>
       <vms>
	  <total>10</total>
	  <active>3</active>
       </vms>
       <hosts>
	  <total>2</total>
	  <active>2</active>
       </hosts>
       <users>
	  <total>8</total>
	  <active>2</active>
       </users>
       <storage_domains>
	  <total>2</total>
	  <active>2</active>
       </storage_domains>
    </summary>
 </api>
         ]]>
         </programlisting>
         </para>            
      </example>
      <note>
         <para>
            为简单起见，所有其他的例子都忽略了<emphasis>Host:</emphasis>和<emphasis>Authorization:</emphasis>请求头并假设<emphasis>base</emphasis>是缺省的<emphasis>/api</emphasis>路径。这个基本的路经会因你实现的不同而不同。
         </para>
      </note>
   </section>

   <section id="sect-EayunOS-Developer-guide-entry-points_Chapter-entry-points_Section_2">
      <title>产品信息</title>
      <para>
         入口点包含了<emphasis>产品信息</emphasis>元素以帮助API用户检测&OVIRT;虚拟环境的合法性。它包含了产品、<emphasis>厂商</emphasis>和<emphasis>版本</emphasis>的<emphasis>名字</emphasis>。
      </para> 
      <example>
         <title>证实一个真正的&OVIRT;虚拟化环境</title>
         <para>
            下面的元素可以确认了一个真正的&OVIRT;虚拟化3.2环境：
         </para>
         <para>
         <programlisting>
         <![CDATA[
 <api>
    ...
    <product_info>
       <name>Red Hat Enterprise Virtualization</name>
       <vendor>Red Hat</vendor>
       <version revision="0" build="0" minor="2" major="3"/>
    </product_info>
    ...
 </api>
         ]]>
         </programlisting>
         </para>            
      </example>
   </section>
      
   <section id="sect-EayunOS-Developer-guide-entry-points_Chapter-entry-points_Section_3">
         <title>链接元素</title>
         <para>
            访问切入点为API显现出来的所有的资源集合提供了链接元素和统一资源标示符。每一个集合都会使用一种关联类型来鉴定客户端需要的资源标示符
         </para>
         <table>
            <title>可用关系类型</title>
         <tgroup cols="2" align="left" colsep="1" rowsep="1">
               <thead>
                  <row>
                     <entry>
                        关系
                     </entry>
                     <entry>
                        描述
                     </entry>
                  </row>
               </thead>
               <tbody>
                  <row>
                     <entry>
                        <emphasis>capabilities</emphasis>
                     </entry>
                     <entry>
                        &OVIRT;企业级虚拟管理具有的性能
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>datacenters</emphasis>
                     </entry>
                     <entry>
                        数据中心
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>clusters</emphasis>
                     </entry>
                     <entry>
                        主机集群
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>networks</emphasis>
                     </entry>
                     <entry>
                        虚拟网络
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>storagedomains</emphasis>
                     </entry>
                     <entry>
                        存储域
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>hosts</emphasis>
                     </entry>
                     <entry>
                        主机
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>vms</emphasis>
                     </entry>
                     <entry>
                        虚拟机
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>disks</emphasis>
                     </entry>
                     <entry>
                        虚拟机硬盘
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>templates</emphasis>
                     </entry>
                     <entry>
                        模板
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>vmpools</emphasis>
                     </entry>
                     <entry>
                        虚拟机池
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>domains</emphasis>
                     </entry>
                     <entry>
                        标识服务域
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>groups</emphasis>
                     </entry>
                     <entry>
                        被导入的标识服务群
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>roles</emphasis>
                     </entry>
                     <entry>
                        角色
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>users</emphasis>
                     </entry>
                     <entry>
                        用户
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>tags</emphasis>
                     </entry>
                     <entry>
                        标签   
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>events</emphasis>
                     </entry>
                     <entry>
                        事件
                     </entry>
                  </row>
               </tbody>
            </tgroup>
         </table>
         <figure id="api-resource-relationship"><title>API入口与API标示出来的资源集之间的关系</title>
            <mediaobject>
               <imageobject>
                  <imagedata fileref="images/api-resource-relationship.png" format="PNG" scale="65"/>
               </imageobject>
            </mediaobject>
         </figure>
         <note>
            <para>
               显示在示例相应中的所有资源标识符独具有说明性。服务器传回来的所有统一资源标识符的格式都很模糊。
               服务器选择在<emphasis>链接</emphasis>元素的<emphasis>href</emphasis>属性中包含绝对资源标识符或者绝对路径，所以客户端需要去处理这两种形式。
            </para>
         </note>
         <para>
            <emphasis>链接</emphasis>元素还为某些集合包含了一系列的<emphasis>搜索</emphasis>URI。这些URI使用了URI模板来集成搜索查询。URI模板的作用是接受一个使用了查询参数的HTTP模式的检索表达式。客户端对较早的URI结构的只是没有过高的要求。然而，客户端不可以忽视URI模板并且要通过URI模板库来获得它们。每一个检索查询URI模板都是以一个关系类型为命名标准，通常的命名格式为:<emphasis>"collection/search"</emphasis>
         </para>
         <table>
            <title>与检索URI查询有关的关系</title>
            <tgroup cols="2" align="left" colsep="1" rowsep="1">
               <thead>
                  <row>
                     <entry>
                        关系
                     </entry>
                     <entry>
                        描述
                     </entry>
                  </row>
               </thead>
               <tbody>
                  <row>
                     <entry>
                        <emphasis>datacenters/search</emphasis>
                     </entry>
                     <entry>
                        查询数据中心
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>clusters/search</emphasis>
                     </entry>
                     <entry>
                        查询主机集群
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>storagedomains/search</emphasis>
                     </entry>
                     <entry>
                        查询存储域
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>hosts/search</emphasis>
                     </entry>
                     <entry>
                        查询主机
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>vms/search</emphasis>
                     </entry>
                     <entry>
                        查询虚拟机
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>disks/search</emphasis>
                     </entry>
                     <entry>
                        查询硬盘
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>templates/search</emphasis>
                     </entry>
                     <entry>
                        查询模板
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>vmpools/search</emphasis>
                     </entry>
                     <entry>
                        查询虚拟机池
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>events/search</emphasis>
                     </entry>
                     <entry>
                        查询事件
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>users/search</emphasis>
                     </entry>
                     <entry>
                        查询用户
                     </entry>
                  </row>
               </tbody>
            </tgroup>
         </table>
   </section>   
   <section id="sect-EayunOS-Developer-guide-entry-points_Chapter-entry-points_Section_4">
      <title>特殊的对象元素</title>
      <para>
         特殊的对象元素定义了特别固定的资源和虚拟环境的资源。
         <table>
            <title>特殊对象</title>
            <tgroup cols="2" align="left" colsep="1" rowsep="1">
               <thead>
                  <row>
                     <entry>
                        关系
                     </entry>
                     <entry>
                        描述
                     </entry>
                  </row>
               </thead>
               <tbody>
                  <row>
                     <entry>
                        <emphasis>templates/blank</emphasis>
                     </entry>
                     <entry>
                        系统默认值为虚拟环境清空了的虚拟机模板。这个模板不同于一个标准的模板，它存在于每一个集群当而不是单一的集群当中。
                     </entry>
                  </row>   
                  <row>
                     <entry>
                        <emphasis>tags/root</emphasis>
                     </entry>
                     <entry>
                        根标签在虚拟机当中扮演着比较基础的角色。
                     </entry>
                  </row>
               </tbody>
            </tgroup>
         </table>
      </para>
   </section>
   <section id="sect-EayunOS-Developer-guide-entry-points_Chapter-entry-points_Section_5">
         <title>总结元素</title>
         <para>   
            总结元素显示了系统策略的一个高的水平的总结。   
         </para>
         <table>
            <title>总结元素</title>
            <tgroup cols="2" align="left" colsep="1" rowsep="1">
               <thead>
                  <row>
                     <entry>
                        元素
                     </entry>
                     <entry>
                        描述
                     </entry>
                  </row>
               </thead>
               <tbody>
                  <row>
                     <entry>
                        <emphasis>vms</emphasis>
                     </entry>
                     <entry>
                        虚拟机和工作中的虚拟机的总数量
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>hosts</emphasis>
                     </entry>
                     <entry>
                        主机和工作中的主机的总数量
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>users</emphasis>
                     </entry>
                     <entry>
                        用户和正在使用的用户的总数量
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>storage_domains</emphasis>
                     </entry>
                     <entry>
                            存储域和工作中的存储域的总数量
                     </entry>
                  </row>
               </tbody>
            </tgroup>
         </table>
   </section>
   <section id="sect-EayunOS-Developer-guide-entry-points_Chapter-entry-points_Section_6">
      <title>REST式服务语言（RSDL）</title>
      <para>
         REST式服务描述语言(REDL)在整个XML的说明书，在REST API中提供了对结构和元素的描述，注入RSDL需要以下请求。
      </para>
      <screen>
         GET /api?rsdl HTTP/1.1
         Accept: application/xml
      </screen>
      <para>
         它生成了一个如下的XML文件
      </para> 
      <programlisting>
         <![CDATA[
 <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
 <rsdl href="/api?rsdl" rel="rsdl">
 <description>...</description>
 <version major="3" minor="1" build="0" revision="0"/>
 <schema href="/api?schema" rel="schema">
 <name>...</name>
 <description>...</description>
 </schema>

 <links>
 <link href="/api/capabilities" rel="get">
 ...
 </link>
 ...
 </links>
 </rsdl>
]]>
      </programlisting>
      <table>
         <title>RSDL结构元素</title>
         <tgroup cols="2" align="left" colsep="1" rowsep="1">
               <thead>
                  <row>
                     <entry>
                        元素
                     </entry>
                     <entry>
                        描述
                     </entry>
                  </row>
               </thead>
               <tbody>
                  <row>
                     <entry>
                        <emphasis>description</emphasis>
                     </entry>
                     <entry>
                        RSDL文档的简要描述。
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>version</emphasis>
                     </entry>
                     <entry>
                        API版本包括了<emphasis>major</emphasis>版，<emphasis>minor</emphasis>版，<emphasis>build</emphasis>版和<emphasis>revision</emphasis>版。
                     </entry>
                  </row>
                  <row>
                     <entry>
                        <emphasis>schema</emphasis>
                     </entry>
                     <entry>
                         XML模式(XSD)文件的链接。
                     </entry>
                  </row>
                  <row>   
                     <entry>
                        <emphasis>links</emphasis>
                     </entry>
                     <entry>
                         在API中定义每一个链接。
                     </entry>
                  </row>
               </tbody>
         </tgroup>
      </table>
      <para>   
         每一个链接元素包含了以下结构：
      </para>
      <para>
         <programlisting>
	    <![CDATA[
 <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
 <rsdl href="/api?rsdl" rel="rsdl">
 ...
 <links>
 <link href="/api/..." rel="...">
 <request>
 <http_method>...</http_method>
 <headers>
 <header>
 <name>...</name>
 <value>...</value>
 </header>
 ...
 </headers>
 <body>
 <type>...</type>
 <parameters_set>
 <parameter required="..." type="...">
 <name>...</name>
 </parameter>
 ...
 </parameters_set>
 </body>
 </request>
 <response>
 <type>...</type>
 </response>
 </link>
 ...
 </links>
 </rsdl>
]]>
         </programlisting>
      </para>
      <table>
         <title>RSDL链接结构元素</title>
         <tgroup cols="2" align="left" colsep="1" rowsep="1">
            <thead>
               <row>
                  <entry>
                     元素
                  </entry>
                  <entry>
                     描述
                  </entry>
               </row>
            </thead>
            <tbody>
               <row>
                  <entry>
                     <emphasis>link</emphasis>
                  </entry>
                  <entry>
                     一个用于API请求的URI。包括一额URI属性(<emphasis>href</emphasis>)和一个关系类型属性(<emphasis>rel</emphasis>)
                  </entry>
               </row>
               <row>
                  <entry>
                     <emphasis>request</emphasis>
                  </entry>
                  <entry>
                     定义了用于链接的请求属性。
                  </entry>
               </row>
               <row>
                  <entry>
                     <emphasis>http_method</emphasis>
                  </entry>
                  <entry>
                     获得链接的方法类型。包括标准的HTTP REST API访问方法：<emphasis>GET,POST,PUT</emphasis>和<emphasis>DELETE</emphasis>。
                  </entry>
               </row>
               <row>
                  <entry>
                     <emphasis>headers</emphasis>
                  </entry>
                  <entry>
                     定义了HTTP请求头。包含了一系列的<emphasis>header</emphasis>元素，在请求头部包含了请求头的<emphasis>name</emphasis>和<emphasis>value</emphasis>,以此来定义请求头信息。
                  </entry>
               </row>
               <row>
                  <entry>
                     <emphasis>body</emphasis>                 
                  </entry>
                  <entry>
                     定义了HTTP请求体。包含了资源<emphasis>类型</emphasis>和一个<emphasis>参数设置</emphasis>，它包含了一些列带有定义是否需要一个的参数元素
                  </entry>
               </row>
               <row>
                  <entry>
                     <emphasis>response</emphasis>
                  </entry>
                  <entry>
                     定义了HTTP请求的OutPut。包含了元素类型来定义资源结构
                  </entry>
               </row>
            </tbody>
         </tgroup>
      </table>
   </section>
</chapter>
