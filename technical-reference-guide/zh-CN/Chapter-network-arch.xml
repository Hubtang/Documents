<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [ <!ENTITY % BOOK_ENTITIES SYSTEM "technical-reference-guide.ent"> %BOOK_ENTITIES;
]>
<chapter id="chap-Documents-technical-reference-guide-Chapter-network-arch">
	<title>&OVIRT;网络架构</title>
	<para>
	</para>
	<section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_1">
		<title>网络架构概述</title>
		<para>
                  &OVIRT;的网络可以分成三个部分来说明：网络基础、集群中的网络和主机的网络配置。 
                    <itemizedlist>
                        <listitem>
                         <para>
                          网络基础其实就是介绍一些术语，即相关的硬件、软件。
                         </para>
                        </listitem>
                        <listitem>
                         <para>
                          集群中网络也就是集群这个逻辑概念下的一些对象如：逻辑网络、虚拟机网络、主机网络等。
                         </para>
                        </listitem>
                        <listitem>
                         <para>
                          主机的网络配置，就是诸如网卡绑定、VLAN等常见的主机配置。
                         </para>
                        </listitem>
                    </itemizedlist>
		</para> 
	</section>
	
	<section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_2">
		<title>网络基础</title>
                   <para></para>
                    <important>
                        <para>
                        </para>
                    </important>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_2-1">
		     <title>介绍，网络术语</title>
		       <para>
                        &OVIRT;所使用到的网络术语有如下几项，包括主机、虚拟机以及网络设备   
                         <itemizedlist>
                           <listitem>
                             <para>
                                网卡
                             </para>
                           </listitem>
                           <listitem>
                             <para>
                                网桥
                             </para>
                           </listitem>
                           <listitem>
                             <para>
                                网卡绑定
                             </para>
                           </listitem>
                           <listitem>
                             <para>
                                虚拟网卡
                             </para>
                           </listitem>
                           <listitem>
                             <para> 
                                虚拟局域网(VLAN)
                             </para>
                           </listitem>
                         </itemizedlist>
                          网卡、网桥、虚拟网卡可实现主机、虚拟机、本地网络以及Internet相互通信，网卡绑定以及VLAN属于可选项，可实现诸如安全、容错及增强。
		       </para>
                      
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_2-2">
		     <title>物理网卡</title>
		       <para>
                        物理网卡的作用是连接计算机到用户的网络环境，提供物理层和数据链路层的网络连接。&OVIRT;要求用户的主机上至少拥有一块物理网卡，要达到很好的性能要求，&OVIRT;建议尽可能多的网卡配置。                      
		       </para>
                       <para>
                        物理网卡的另一个作用是和多个虚拟网卡建立逻辑上的互联互通，虚拟网卡在虚拟机中的表现则是一块物理网卡，为了区分物理网卡和虚拟网卡的区别，&OVIRT;会为每个虚拟网卡分配一个独一无二的MAC地址。
                       </para>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_2-3">
		     <title>网桥</title>
		       <para>
                        网桥是一个软件实现的设备，主要用于交换网络中的包的转发。它能够实现在一块物理网卡的情况下多个虚拟网卡设备共享连接，并且区分的非常清楚，往前会侦查数据包的源地址来均定相应目标地址，一旦目标地址均定了，网桥会在数据包中加上响应的地址，这样就能够实现网桥中的所有虚拟物理网卡的转发功能。 
		       </para>
                       <para>
                       &OVIRT;中逻辑网络的实现即是使用了网桥，在实际的工作中，由网桥来接管主机的物理网卡的IP地址，尽管网桥的子网不必和虚拟网卡的子网一样，相对独立，但是我们建议分配同样的子网，这样也就是真正的意义所在，客户操作系统使用虚拟网卡来和网桥通信，网桥使用物理网卡和外界通信。
                       </para>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_2-4">
		     <title>Bond</title>
		       <para>
                       网卡Bond技术是聚合多块物理网卡当作一块来使用，以增加容错能力、增强传输速率等。当然，网卡的Bond有个硬性的需求，那就是必须是同样的型号、以及同样的厂家产品。
		       </para>
                       <para>
                        网卡Bond有几种模式，每种模式使用了不同的算法实现。
                       </para>
                       <formalpara><title>Bond的7中模式</title>
                         <para>
                          &OVIRT;默认使用模式4.
                         <itemizedlist>
                            <listitem>
                              <para>
                                模式0：（轮循）
                              </para>
                            </listitem>
                            <listitem>
                              <para>
                                模式1：（主备）
                              </para>
                            </listitem>
                            <listitem>
                              <para>
                                模式2：（XOR）
                              </para>
                            </listitem>
                            <listitem>
                              <para>
                                模式3：（广播）
                              </para>
                            </listitem>
                            <listitem>
                              <para>
                              模式4：（聚合）  
                              </para>
                            </listitem>
                            <listitem>
                              <para>
                                模式5：（自适应传输负载均衡）
                              </para>
                            </listitem>
                            <listitem>
                              <para>
                                模式6：（自适应负载均衡）
                              </para>
                            </listitem>
                         </itemizedlist>
                        </para>
                       </formalpara>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_2-5">
		     <title>bonding下的交换机设置</title>
		       <para>
                        以下是一个常见的实例，请您根据自身的实际情况设定，或联系交换机厂商。
		       </para>
                            <programlisting language="python">
                   <![CDATA[
interface Port-channel11
switchport access vlan 153
switchport mode access
spanning-tree portfast disable
spanning-tree bpduguard disable
spanning-tree guard root
interface GigabitEthernet0/16
switchport access vlan 153
switchport mode access
channel-group 11 mode active
interface GigabitEthernet0/17
switchport access vlan 153
switchport mode access
]]>

                            </programlisting>
                         <important>
                             <para>
                                对于不管何种型号的交换机来说，设置网卡Bond，以支持Link Aggregation Control Protocol (LACP)协议都是非常重要的一个环节。请注意协议，不是思科Port Aggregation Protocol (PAgP)协议。
                             </para>
                         </important>       
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_2-6">
		     <title>虚拟机网卡</title>
		       <para>
                      
		       </para>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_2-7">
		     <title>虚拟局域网(VLAN)</title>
		       <para>
                      
		       </para>
	         </section>
	</section>

	<section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_3">
		<title>数据中心和集群的网络</title>
		<para>
                      
		</para>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_3-1">
		     <title>集群网络</title>
		       <para>
                      
		       </para>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_3-2">
		     <title>逻辑网络</title>
		       <para>
                      
		       </para>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_3-3">
		     <title>网络的需求、可选的网络以及虚拟机的网络</title>
		       <para>
                      
		       </para>
	         </section>
	</section>

	<section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_4">
		<title>主机和虚拟机的网络</title>
		<para>
                      
		</para>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_4-1">
		     <title>网络架构概述</title>
		       <para>
                      
		       </para>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_4-2">
		     <title>虚拟机的连接</title>
		       <para>
                      
		       </para>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_4-3">
		     <title>端口镜像</title>
		       <para>
                      
		       </para>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_4-4">
		     <title>主机网络配置</title>
		       <para>
                      
		       </para>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_4-5">
		     <title>网桥配置</title>
		       <para>
                      
		       </para>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_4-6">
		     <title>VLAN配置</title>
		       <para>
                      
		       </para>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_4-7">
		     <title>网桥和Bond的配置</title>
		       <para>
                      
		       </para>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_4-8">
		     <title>多网桥、多VLAN，网卡的配置</title>
		       <para>
                      
		       </para>
	         </section>
	         <section id="sect-Documents-technical-reference-guide-Chapter-network-arch-Section_4-9">
		     <title>多网桥、多VLAN、bond的配置</title>
		       <para>
                      
		       </para>
	         </section>
	</section>

</chapter>

