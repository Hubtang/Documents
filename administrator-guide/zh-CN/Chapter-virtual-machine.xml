<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "administrator-guide.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-Documents-administrator-guide-Chapter-virtual-machine">
  <title>虚拟机</title>
  <para>
    This is a test paragraph
  </para>
  <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_1">
    <title>虚拟机介绍</title>
    <para>
      虚拟机指通过软件模拟的具有完整硬件系统功能的计算机系统. 目前 &OVIRT; 管理
      系统允许用户创建两种形式的虚拟机, 虚拟桌面和虚拟服务器.
    </para>

    <para>
      虚拟机使得管理和利用计算机更加简单快捷. 传统的计算环境要求每一个计算任务在
      独立的硬件资源下运行, 通过使用虚拟机, 可以更有效地利用硬件资源, 并且, 管理
      上也更便捷.
    </para>
  </section>

  <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_2">
    <title>&OVIRT;支持的虚拟机操作系统</title>
    <para>
      目前 &OVIRT;支持以下虚拟机操作系统:
    </para>

    <table id="VM_Supported_Virtual_Machine_OS">
      <title>支持的虚拟机操作系统</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <thead>
          <row>
            <entry>
              操作系统
            </entry>
            <entry>
              架构
            </entry>
            <entry>
              SPICE 支持
            </entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>
              Red Hat Enterprise Linux 3(或CentOS 3)
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              是
            </entry>
          </row>
          <row>
            <entry>
              Red Hat Enterprise Linux 4(或CentOS 4)
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              是
            </entry>
          </row>
          <row>
            <entry>
              Red Hat Enterprise Linux 5(或CentOS 5)
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              是
            </entry>
          </row>
          <row>
            <entry>
              Red Hat Enterprise Linux 6(或CentOS 6)
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              是
            </entry>
          </row>
          <row>
            <entry>
              SUSE Linux Enterprise Server 10
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              否
            </entry>
          </row>
          <row>
            <entry>
              SUSE Linux Enterprise Server 11
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              否
            </entry>
          </row>
          <row>
            <entry>
              Ubuntu 12.04 (Precise Pangolin LTS)
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              是
            </entry>
          </row>
          <row>
            <entry>
              Ubuntu 12.10 (Quantal Quetzal
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              是
            </entry>
          </row>
          <row>
            <entry>
              Ubuntu 13.04 (Raring Ringtail)
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              是
            </entry>
          </row>
          <row>
            <entry>
              Ubuntu 13.10 (Saucy Salamander)
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              是
            </entry>
          </row>
          <row>
            <entry>
              Windows XP Service Pack 3 and newer
            </entry>
            <entry>
              32-bit
            </entry>
            <entry>
              是
            </entry>
          </row>
          <row>
            <entry>
              Windows 7
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              是
            </entry>
          </row>
          <row>
            <entry>
              Windows 8
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              否
            </entry>
          </row>
          <row>
            <entry>
              Windows Server 2003 Service Pack 2 and newer
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              是
            </entry>
          </row>
          <row>
            <entry>
              Windows Server 2008
            </entry>
            <entry>
              32-bit, 64-bit
            </entry>
            <entry>
              是
            </entry>
          </row>
          <row>
            <entry>
              Windows Server 2008 R2
            </entry>
            <entry>
              64-bit
            </entry>
            <entry>
              是
            </entry>
          </row>
          <row>
            <entry>
              Windows Server 2012 R2
            </entry>
            <entry>
              64-bit
            </entry>
            <entry>
              否
            </entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    <para>
      对 Windows 8 和 Windows 2012 来讲, 默认使用 RDP(Remote Desktop Protocol)
      作为访问协议, 因为微软增加了一些新的改变到显示的协议上, 这些改动导致 SPICE
      暂时得不到最好的体验.
    </para>
    <note>
      <para>
        因为由于 Red Hat Enterprise Linux 3 and Red Hat Enterprise Linux 4
        是32位内核, 没有 ACPI 的支持, 所以用户在门户直接点击关闭的时候肯能会出现
        问题, 这个时候需要用户右击<keycap>断电</keycap>来关机.
      </para>
    </note>
  </section>

  <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_3">
    <title>虚拟机性能参数</title>
    <para>
      目前 &OVIRT; 管理系统支持的虚拟机参数如下表:
    </para>
    <table id="VM_Supported_Virtual_Machine_Parameters">
      <title>支持的虚拟机参数列表</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <thead>
          <row>
            <entry>
              参数
            </entry>
            <entry>
              数量
            </entry>
            <entry>
              注意
            </entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>
              虚拟机 CPU
            </entry>
            <entry>
              160
            </entry>
            <entry>
              每个虚拟机
            </entry>
          </row>
          <row>
            <entry>
              虚拟机内存
            </entry>
            <entry>
              2TB
            </entry>
            <entry>
              每个 64 位的虚拟机
            </entry>
          </row>
          <row>
            <entry>
              虚拟机内存
            </entry>
            <entry>
              4GB
            </entry>
            <entry>
              每个 32 位的虚拟机(可能由于虚拟机操作系统的不同有所不同, 比如用了 PAE 技术)
            </entry>
          </row>
          <row>
            <entry>
              虚拟磁盘
            </entry>
            <entry>
              8
            </entry>
            <entry>
              每个虚拟机
            </entry>
          </row>
          <row>
            <entry>
              虚拟网卡
            </entry>
            <entry>
              8
            </entry>
            <entry>
              每个虚拟机
            </entry>
          </row>
          <row>
            <entry>
              虚拟 PCI 设备
            </entry>
            <entry>
              32
            </entry>
            <entry>
              每个虚拟机
            </entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </section>

  <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4">
    <title>创建虚拟机</title>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-1">
      <title>基于现成的模板创建虚拟机</title>
      <formalpara><title>摘要</title>
      <para>
        一旦模板已经配置好磁盘, 网络等参数, 用户可以使用模板快速的创建虚拟机.
      </para>
      </formalpara>

      <para>
        从模板创建出来的虚拟机取决于模板的配置. 如果在系统中仍然有基于某个
        模板创建的虚拟机, 那么该模板是不能被删除的. 因为这些虚拟机和模板
        有关联关系. 但是如果选择从模板克隆虚拟机, 那么虚拟机和模板之间的
        就没有这些关联关系.
      </para>

      <procedure>
        <title>基于现成的模板创建虚拟机</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>新建虚拟机</keycap>按钮, 打开<keycap>新建虚拟机</keycap>窗口.
          </para>
        </step>
        <step>
          <para>
            选择<keycap>集群</keycap>, 在<keycap>基于模板</keycap>下拉菜单中
            选择需要的模板.
          </para>
          <figure id="create-vm-from-temp"><title>从模板创建虚拟机</title>
          <mediaobject>
            <imageobject>
              <imagedata fileref="images/vm-create-from-temp.png" format="PNG" scale="100"/>
            </imageobject>
          </mediaobject>
          </figure>
        </step>
        <step>
          <para>
            输入<keycap>名称</keycap>, <keycap>描述</keycap>, 和<keycap>注释</keycap>.
            其它保留默认(或者根据需要可以修改)
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>创建虚拟机.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟机已经创建好了, 在虚拟机列表下会显示出来, 用户可以开始使用这个虚拟机了.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-2">
      <title>使用空白模板创建虚拟机</title>
      <formalpara><title>摘要</title>
      <para>
        用户可以从空白模板创建虚拟机, 然后手动配置该虚拟机.
      </para>
      </formalpara>

      <procedure>
        <title>基于空白模板创建虚拟机</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>新建虚拟机</keycap>按钮, 打开<keycap>新建虚拟机</keycap>窗口.
          </para>
        </step>
        <step>
          <para>
            在<keycap>新建虚拟机</keycap>窗口, 只需要填写虚拟机<keycap>名字</keycap>
            和选择<keycap>操作系统</keycap>, 其它部分保留模板.
          </para>
        </step>
        <step>
          <para>
            如果用户想更细粒度的配置虚拟机参数, 点击<keycap>显示高级选项</keycap>,
            分别配置<keycap>初始运行</keycap>, <keycap>控制台</keycap>等参数.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>.
          </para>
        </step>
        <step>
          <para>
            将会弹出<keycap>新建虚拟机 - 引导操作</keycap>窗口, 用户可以在在其
            引导下配置虚拟磁盘, 虚拟网卡等参数, 或者点击<keycap>以后再配置</keycap>.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟机已经创建好了, 在虚拟机列表下会显示出来, 但是状态是 <keycap>Down</keycap>,
        用户在使用这台虚拟机之前, 最少要创建一个虚拟磁盘, 虚拟网卡, 然后需要
        在上面安装操作系统.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-3">
      <title>创建、编辑虚拟机窗口设置解释</title>
      <para>
      </para>
      <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-3-1">
        <title>虚拟机常规设置解释</title>
        <para>
          下面列出的设置适用于创建和编辑虚拟机.
        </para>
        <table id="VM_General_Setting">
          <title>虚拟机的通用设置</title>
          <tgroup cols='2' align='left' colsep='1' rowsep='1'>
            <thead>
              <row>
                <entry>
                  属性
                </entry>
                <entry>
                  详细描述
                </entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>
                  集群
                </entry>
                <entry>
                  虚拟机将会附加到的集群名字
                </entry>
              </row>
              <row>
                <entry>
                  基于模板
                </entry>
                <entry>
                  模板是一个虚拟机的模型, 里面预定义了虚拟机的规则, 虚拟硬件等参数,
                  安装了相应的操作系统和应用软件. 默认情况下创建虚拟机的时候是
                  空模板.
                </entry>
              </row>
              <row>
                <entry>
                  操作系统
                </entry>
                <entry>
                  虚拟机内部将要运行的操作系统.
                </entry>
              </row>
              <row>
                <entry>
                  优化
                </entry>
                <entry>
                  虚拟机将会基于什么类型优化. 目前有两种类型可供用户选择:
                  <variablelist>
                    <varlistentry><term>服务器</term>
                    <listitem>
                      <para>
                        默认的选项, 基于服务器优化的虚拟机没有声卡等相关设置.
                      </para>
                    </listitem>
                    </varlistentry>
                    <varlistentry><term>桌面</term>
                    <listitem>
                      <para>
                        该优化选项创建的虚拟机有一个声卡, 镜像是精简置配的.
                      </para>
                    </listitem>
                    </varlistentry>
                  </variablelist>
                </entry>
              </row>
              <row>
                <entry>
                  名称
                </entry>
                <entry>
                  虚拟机的名字, 必须限制在 64 个字符之类, 不能包含空格, 至少
                  包含 A-Z 或者 0-9 的一个字符.
                </entry>
              </row>
              <row>
                <entry>
                  描述
                </entry>
                <entry>
                  虚拟机的描述.
                </entry>
              </row>
              <row>
                <entry>
                  注释
                </entry>
                <entry>
                  对虚拟机的描述
                </entry>
              </row>
              <row>
                <entry>
                  Stateless
                </entry>
                <entry>
                  如果想让虚拟机运行在 Stateless 模式, 请勾选这个单选框. Stateless
                  主要是桌面虚拟机使用的选项. 它的工作原理是这样的, 运行 Stateless
                  的虚拟机启动后, 将会创建一个 COW 的临时磁盘, 虚拟磁盘的所有改变
                  都会写入这个磁盘, 原先的磁盘不会被改变. 这样, 该虚拟机关机之后,
                  他的状态就会恢复到开机之前. 如果只是为了很短时间内运行虚拟机,
                  或者只是想临时使用虚拟机, 那么这种模式很有用.
                </entry>
              </row>
              <row>
                <entry>
                  以暂停模式启动
                </entry>
                <entry>
                  选择此配置的话, 虚拟机总是在暂停模式下启动虚拟机. 对于需要
                  准备很长时间才能建立 spice 连接的场景来说, 暂停模式很有用.
                  例如, 如果 spice client 和虚拟机运行的网络很远, 网络
                  很慢的时候.
                </entry>
              </row>
              <row>
                <entry>
                  删除保护
                </entry>
                <entry>
                  选择此项之后, 该虚拟机就不能删除了. 除非该选项被取消.
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
        <para>
          在创建虚拟机或者编辑虚拟机窗口最下方是虚拟网卡的配置, 用<keycap>+</keycap>
          或者<keycap>-</keycap>号来增加或者删除虚拟网卡.
        </para>
      </section>

      <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-3-2">
        <title>虚拟机系统设置解释</title>
        <para>
          下面的设置项适用于新建或者编辑虚拟机的时候
        </para>
        <note>
          <para>
            系统设置只有点击<keycap>显示高级选项</keycap>才会显示.
          </para>
        </note>
        <table id="VM_System_Setting">
          <title>虚拟机系统设置</title>
          <tgroup cols='2' align='left' colsep='1' rowsep='1'>
            <thead>
              <row>
                <entry>
                  属性
                </entry>
                <entry>
                  详细描述
                </entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>
                  内存大小
                </entry>
                <entry>
                  分配给虚拟机的内存总是. 分配虚拟机内存的时候, 要考虑该虚拟机
                  使用的场景. 另外, 虚拟机可用的内存也取决于虚拟机内部操作系统
                  的限制, 比如 32 的操作系统最大只能用 4G 的内存大小.
                </entry>
              </row>
              <row>
                <entry>
                  虚拟 CPU 的总数
                </entry>
                <entry>
                  分配给虚拟机的虚拟 CPU 的数量. 分配的数量不要超过物理机的
                  CPU 总数.
                </entry>
              </row>
              <row>
                <entry>
                  每个虚拟 CPU 插槽的核数
                </entry>
                <entry>
                  每个虚拟 CPU 插槽所拥有的 CPU 内核数目
                </entry>
              </row>
              <row>
                <entry>
                  虚拟插槽
                </entry>
                <entry>
                  分配给虚拟机的虚拟 CPU 插槽数目. 分配的数量不要超过物理机的
                  插槽数目.
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>

      <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-3-3">
        <title>虚拟机初始化运行设置解释</title>
        <para>
          下面的设置项适用于新建或者编辑虚拟机的时候
        </para>
        <note>
          <para>
            初始运行这只只有点击<keycap>显示高级选项</keycap>才会显示.
          </para>
        </note>
        <table id="VM_Initial_Setting">
          <title>虚拟机初始设置</title>
          <tgroup cols='2' align='left' colsep='1' rowsep='1'>
            <thead>
              <row>
                <entry>
                  属性
                </entry>
                <entry>
                  详细描述
                </entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>
                  常规 - 时区
                </entry>
                <entry>
                  指定虚拟机硬件的时区.
                </entry>
              </row>
              <row>
                <entry>
                  Windows - 域
                </entry>
                <entry>
                  虚拟机运行的域. 这个选项只有在操作系统那里设置 Windows 操作
                  系统才有意义.
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>

      <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-3-4">
        <title>虚拟机终端设置解释</title>
        <para>
          下面的设置项适用于新建或者编辑虚拟机的时候
        </para>
        <note>
          <para>
            控制台设置只有点击<keycap>显示高级选项</keycap>才会显示.
          </para>
        </note>
        <table id="VM_Console_Setting">
          <title>虚拟机控制台设置</title>
          <tgroup cols='2' align='left' colsep='1' rowsep='1'>
            <thead>
              <row>
                <entry>
                  属性
                </entry>
                <entry>
                  详细描述
                </entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>
                  协议
                </entry>
                <entry>
                  除了 Windows 8 和 Windows Server 2012, 推荐是用 SPICE 作为
                  Linux 和 Windows 虚拟机的访问协议, 并且它也是默认值. 另外用户
                  还可以选择用 VNC 作为连接的协议.
                </entry>
              </row>
              <row>
                <entry>
                  VNC 键盘格式
                </entry>
                <entry>
                  设置 VNC 的键盘布局. 该选项只有选择 VNC 作为连接协议才会出现.
                </entry>
              </row>
              <row>
                <entry>
                  USB 支持
                </entry>
                <entry>
                  设置是否让虚拟机使用 USB 设备, 该选项只有设置 SPICE 为访问协议
                  才有效. 有下列三种选项可以选择:
                  <variablelist>
                    <varlistentry><term>Disabled</term>
                    <listitem>
                      <para>
                        禁止从 SPICE 客户端运行所在的机器到虚拟机的 USB 重定向.
                      </para>
                    </listitem>
                    </varlistentry>
                    <varlistentry><term>Legacy</term>
                    <listitem>
                      <para>
                        该选项从 3.0 版本之后已经不被支持了.
                      </para>
                    </listitem>
                    </varlistentry>
                    <varlistentry><term>Native</term>
                    <listitem>
                      <para>
                        启用从 SPICE 客户端运行所在的机器到虚拟机的 USB 重定向
                        的支持. 该功能不需要在虚拟机内部安装任何额外的驱动或者
                        代理程序.
                      </para>
                    </listitem>
                    </varlistentry>
                  </variablelist>
                </entry>
              </row>
              <row>
                <entry>
                  监控器
                </entry>
                <entry>
                  设置虚拟显示器的数量. 该选项只有设置 SPICE 为访问协议才有效.
                  用户可以选择<keycap>1</keycap>, <keycap>2</keycap>,
                  <keycap>4</keycap>个.由于 Windows 8 和 Windows Server 2012
                  不支持 SPICE 协议, 所以如果虚拟机是这几类操作系统, 那么该选项无效.
                </entry>
              </row>
              <row>
                <entry>
                  启用智能卡
                </entry>
                <entry>
                  智能卡是在信用卡上安装一个拇指大小的微型电脑芯片, 这个芯片
                  包含了持卡人的各种信息. 可以广泛用于身份识别和支付工具等.
                  利用智能卡, 可以用来保护 &OVIRT; 系统中的虚拟机.
                </entry>
              </row>
              <row>
                <entry>
                  禁用严格的用户检查
                </entry>
                <entry>
                  点击<keycap>高级参数</keycap>就可以看到该选项, 如果设置了该
                  选项, 那么在已经有一个用户连接了虚拟机的时候, 另一个用户想要
                  连接的话, 不需要重启该虚拟机. 用户检查有在一种情况下例外, 在
                  超级用户想要连接该虚拟机的时候, 其它用户就不能连接该虚拟机,
                  如果其它用户想要连接, 只能等到虚拟机重启.
                </entry>
              </row>
              <row>
                <entry>
                  启用声卡
                </entry>
                <entry>
                  并不是所有的虚拟机都想要一个虚拟声卡设备, 比如你的虚拟机用来
                  运行服务器应用, 那么虚拟声卡就不需要. 用户可以根据自己的需求
                  来启用或者禁用声卡.
                </entry>
              </row>
              <row>
                <entry>
                  VirtIO Console Device Enabled
                </entry>
                <entry>
                  VirtIO Console 设备是一种用于主机的应用程序和虚拟机的应用
                  程序之间通信的设备. 它是一个 QEMU 模拟的设备. 它有两端和这个
                  设备连接, 主机端和虚拟机端, 主机端通常对应一个本地网络套接字等
                  用户可以读写的设备, 虚拟机端对应一个字符设备, 有驱动用来
                  给虚拟机的应用程序提供读写这个设备的接口. 这样, 数据流就
                  在这两端建立了.
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
        <para>
        </para>
      </section>

      <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-3-5">
        <title>虚拟机主机设置解释</title>
        <para>
          下面的设置项适用于新建或者编辑虚拟机的时候
        </para>
        <note>
          <para>
            主机设置只有点击<keycap>显示高级选项</keycap>才会显示.
          </para>
        </note>
        <table id="VM_Host_Setting">
          <title>虚拟机主机设置</title>
          <tgroup cols='2' align='left' colsep='1' rowsep='1'>
            <thead>
              <row>
                <entry>
                  属性
                </entry>
                <entry>
                  详细描述
                </entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>
                  开始运行在
                </entry>
                <entry>
                  <para>
                    设置虚拟机开始运行在哪台主机:
                  </para>
                  <variablelist>
                    <varlistentry><term>群集里的任何主机</term>
                    <listitem>
                      <para>
                        虚拟机开始可以运行在群集里的任何主机上.
                      </para>
                    </listitem>
                    </varlistentry>
                    <varlistentry><term>专有的</term>
                    <listitem>
                      <para>
                        虚拟机开始运行在用户指定的集群里的某一台主机上. 但是
                        在集群的迁移策略或者高可用生效的时候, 虚拟机有可能会被
                        迁移到其它主机上运行.
                      </para>
                    </listitem>
                    </varlistentry>
                  </variablelist>
                </entry>
              </row>
              <row>
                <entry>
                  移植选项
                </entry>
                <entry>
                  <para>
                    设置虚拟机的移植选项, 如果这里的选项没有被使用, 那么虚拟机的
                    移植设置和群集的移植设置一致.
                  </para>
                  <variablelist>
                    <varlistentry><term>允许手动和自动移植</term>
                    <listitem>
                      <para>
                        虚拟机能根据群集状态自动的移植到另一台主机上, 也可由
                        用户手动开始移植.
                      </para>
                    </listitem>
                    </varlistentry>
                    <varlistentry><term>只允许手动移植</term>
                    <listitem>
                      <para>
                        虚拟机只能通过用户手动从移植到另一台主机上.
                      </para>
                    </listitem>
                    </varlistentry>
                    <varlistentry><term>不允许移植</term>
                    <listitem>
                      <para>
                        虚拟机不能被移植, 不管是自动还是手动.
                      </para>
                    </listitem>
                    </varlistentry>
                  </variablelist>
                </entry>
              </row>
              <row>
                <entry>
                  使用主机 CPU
                </entry>
                <entry>
                  <para>
                    该选项可以让虚拟机充分利用主机的 CPU 指令集. 该选项只有当
                    用户选择了<keycap>只允许手动迁移</keycap>和<keycap>不允许迁移</keycap>
                    时才能选择.
                  </para>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>

      <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-3-6">
        <title>虚拟机高可用设置解释</title>
        <para>
          下面的设置项适用于新建或者编辑虚拟机的时候
        </para>
        <note>
          <para>
            高可用设置只有点击<keycap>显示高级选项</keycap>才会显示.
          </para>
        </note>
        <table id="VM_High_Availability_Setting">
          <title>虚拟机高可用设置</title>
          <tgroup cols='2' align='left' colsep='1' rowsep='1'>
            <thead>
              <row>
                <entry>
                  属性
                </entry>
                <entry>
                  详细描述
                </entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>
                  高度可用的
                </entry>
                <entry>
                  <para>
                    选择此项来设置虚拟机的高可用. 例如, 当主机转为维护模式或者
                    主机异常时, 虚拟机将会被自动的迁移到其它主机或者在其它主机
                    上重新运行. 但是如果主机被管理员手动关系, 那么虚拟机并
                    不会被自动迁移到另一台主机
                  </para>
                  <para>
                    注意如果虚拟机的迁移选项设置为<keycap>只允许手动移植</keycap>,
                    或者<keycap>不允许移植</keycap>, 则该选项是无效的. 虚拟机要
                    设置为高可用的, 那么它必须在需要的时候可以被迁移到其它主机.
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  运行/移植队列的优先级
                </entry>
                <entry>
                  <para>
                    设置该虚拟机被迁移到另一台主机或者在另一台主机上重新运行的
                    优先级.
                  </para>
                </entry>
              </row>
              <row>
                <entry>
                  Watchdog
                </entry>
                <entry>
                  <para>
                    允许用户给虚拟机添加一个看门狗计时器. 看门狗计时器主要用来
                    检测和恢复机器的硬件错误. 一旦设置了看门狗计时器, 当系统
                    运行时, 计时器不断的自我减小, 如果系统运行正常时, 系统驱动
                    不断重置计时器使得计时器不为0, 如果计时器变为0, 则说明系统
                    除了问题. 相应的看门狗计时器就要采取相应的动作. 该功能常用于
                    服务器的高可用.
                  </para>
                  <para>
                    <keycap>Watchdog 模型</keycap>: 添加到虚拟机的看门口定时器的
                    设备类型. 目前我们只支持<keycap>i6300esb</keycap>.
                  </para>

                  <para>
                    <keycap>Watchdog 动作</keycap>:
                  </para>
                  <itemizedlist>
	                <listitem>
	                  <para>
                        <keycap>无</keycap> - 不采取任何动作. 不过该事件仍会
                        记录到审计日志里.
	                  </para>
	                </listitem>
                    <listitem>
	                  <para>
                        <keycap>重置</keycap> - 虚拟机将会被重启, 管理端会得到
                        该重置事件的通知.
	                  </para>
	                </listitem>
                    <listitem>
	                  <para>
                        <keycap>断电</keycap> - 虚拟机马上被断电关闭.
	                  </para>
	                </listitem>
                    <listitem>
	                  <para>
                        <keycap>转储</keycap> - 执行转储操作, 虚拟机马上被暂停.
	                  </para>
	                </listitem>
                    <listitem>
	                  <para>
                        <keycap>暂停</keycap> - 虚拟机将被暂定, 随后可以被用户恢复.
	                  </para>
	                </listitem>
                  </itemizedlist>
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>

      <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-3-7">
        <title>虚拟机资源分配设置解释</title>
        <para>
          下面的设置项适用于新建或者编辑虚拟机的时候
        </para>
        <note>
          <para>
            高可用设置只有点击<keycap>显示高级选项</keycap>才会显示.
          </para>
        </note>
        <table id="VM_Resource_Allocation_Setting">
          <title>支持的虚拟机参数列表</title>
          <tgroup cols='3' align='left' colsep='1' rowsep='1'>
            <thead>
              <row>
                <entry>
                  参数
                </entry>
                <entry>
                  子元素
                </entry>
                <entry>
                  描述
                </entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>
                  CPU 分配
                </entry>
                <entry>
                  CPU 共享
                </entry>
                <entry>
                  允许用户设置相当于其他虚拟机, 这台虚拟机能使用的 CPU 资源.
                  <itemizedlist>
	                <listitem>
	                  <para>
                        <keycap>低</keycap> - 512
	                  </para>
	                </listitem>
	                <listitem>
	                  <para>
                        <keycap>中</keycap> - 1024
	                  </para>
	                </listitem>
	                <listitem>
	                  <para>
                        <keycap>高</keycap> - 2048
	                  </para>
	                </listitem>
	                <listitem>
	                  <para>
                        <keycap>自定义</keycap> - 由用户定义具体的数值
	                  </para>
	                </listitem>
                  </itemizedlist>
                </entry>
              </row>
              <row>
                <entry>
                </entry>
                <entry>
                  CPU pinning 拓扑结构
                </entry>
                <entry>
                  该选项能使得虚拟机运行在物理主机的物理 CPU 上. 使用方法为:
                  <itemizedlist>
	                <listitem>
	                  <para>
                        <keycap>0#0</keycap> - 绑定虚拟 CPU 0 和物理 CPU 0
	                  </para>
	                </listitem>
	                <listitem>
	                  <para>
                        <keycap>0#0_1#3</keycap> - 绑定虚拟 CPU 0 和物理 CPU 0,
                        同事绑定虚拟 CPU 0 和物理 CPU 3
	                  </para>
	                </listitem>
	                <listitem>
	                  <para>
                        <keycap>1#1-4,^2</keycap> - 绑定虚拟 CPU 0 和物理 CPU
                        1-4中的一个, 除了物理 CPU 2
	                  </para>
	                </listitem>
                  </itemizedlist>
                  为了能绑定虚拟 CPU 和物理 CPU, 迁移设置必须选择<keycap>不允许迁移</keycap>.
                </entry>
              </row>
              <row>
                <entry>
                  内存分配
                </entry>
                <entry>
                  保证的物理内存
                </entry>
                <entry>
                  保证分给虚拟机的物理内存数量.
                </entry>
              </row>
              <row>
                <entry>
                </entry>
                <entry>
                  启用内存 Balloon 设备
                </entry>
                <entry>
                  是否启用 Balloon 设备. Balloon 设备能提高主机利用内存的能力,
                  能让同一台主机多运行虚拟机, 不过会使得虚拟机的性能有一点降低.
                </entry>
              </row>
              <row>
                <entry>
                  存储分配
                </entry>
                <entry>
                </entry>
                <entry>
                  只有从模板创建的虚拟机才能使用<keycap>模板 Provision</keycap> 选项.
                </entry>
              </row>
              <row>
                <entry>
                </entry>
                <entry>
                  Thin
                </entry>
                <entry>
                  该类型只有需要时候才会发生存储的分配, 这种类型的分配是对空间
                  的优化, 比 clone 的性能要差一点.
                </entry>
              </row>
              <row>
                <entry>
                </entry>
                <entry>
                  Clone
                </entry>
                <entry>
                  在创建磁盘初始, 就完成了所有磁盘的分配, 比 Thin 的读写速度要高,
                  不过空间占用比 Thin 的多.
                </entry>
              </row>
              <row>
                <entry>
                </entry>
                <entry>
                  VirtIO-SCSI Enabled
                </entry>
                <entry>
                  是否启用 VirtIO-SCSI的控制器, 默认的 VirtIO 磁盘使用的是 IDE
                  的控制器. 这里可以改变默认方式.
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>
      <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-3-8">
        <title>虚拟机启动设置解释</title>
        <para>
          下面的设置项适用于新建或者编辑虚拟机的时候
        </para>
        <note>
          <para>
            启动设置只有点击<keycap>显示高级选项</keycap>才会显示.
          </para>
        </note>
        <table id="VM_Boot_Setting">
          <title>虚拟机启动设置</title>
          <tgroup cols='2' align='left' colsep='1' rowsep='1'>
            <thead>
              <row>
                <entry>
                  属性
                </entry>
                <entry>
                  详细描述
                </entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>
                  第一个设备
                </entry>
                <entry>
                  有三种类型的设备可以作为引导的第一个设备:
                  <itemizedlist>
	                <listitem>
	                  <para>
                        硬盘
	                  </para>
	                </listitem>
	                <listitem>
	                  <para>
                        CD-ROM
	                  </para>
	                </listitem>
	                <listitem>
	                  <para>
                        网络(PXE)
	                  </para>
	                </listitem>
                  </itemizedlist>
                </entry>
              </row>
              <row>
                <entry>
                  第二个设备
                </entry>
                <entry>
                  如果第一个设备启动失败, 那么就会从这里选择的第二个设备启动,
                  注意, 之前在第一个设备选择的设备在这里被隐藏了.
                </entry>
              </row>
              <row>
                <entry>
                  附加 CD
                </entry>
                <entry>
                  这里可以给虚拟机附加 CD, 这里的 CD ISO 映像只能从 ISO
                  存储域里面选择.
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>
      <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-3-9">
        <title>虚拟机自定义属性设置解释</title>
        <para>
          下面的设置项适用于新建或者编辑虚拟机的时候
        </para>
        <note>
          <para>
            自定义属性设置只有点击<keycap>显示高级选项</keycap>才会显示.
          </para>
        </note>
        <table id="VM_Custom_Properties_Setting">
          <title>自定义属性设置</title>
          <tgroup cols='3' align='left' colsep='1' rowsep='1'>
            <thead>
              <row>
                <entry>
                  属性
                </entry>
                <entry>
                  详细描述
                </entry>
                <entry>
                  推荐值和限制
                </entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>
                  sap_agent
                </entry>
                <entry>
                  给设置 SAP 监控.
                </entry>
                <entry>
                  -
                </entry>
              </row>
              <row>
                <entry>
                  sndbuf
                </entry>
                <entry>
                  设置虚拟机套接字的发送缓存大小, 默认值是 0.
                </entry>
                <entry>
                  -
                </entry>
              </row>
              <row>
                <entry>
                  vhost
                </entry>
                <entry>
                  可以将vhost-net 禁用掉, vhost-net 是在主机的 virtio 网络
                  驱动, 可以提高虚拟机的网络性能.
                </entry>
                <entry>
                  vhost-net 提供了比 virtio-net更高的网络性能, 禁用此项通常
                  用来隔离某个虚拟机, 然后调试该虚拟机的网络.
                </entry>
              </row>
              <row>
                <entry>
                  viodiskcache
                </entry>
                <entry>
                  设置 virtio 磁盘的缓存模式. <keycap>writethrough</keycap>
                  同时把数据写到缓存和磁盘中才返回, 性能较低. <keycap>writeback</keycap>
                  将数据写入到缓存中就返回, 性能较高, 但是不能保证数据安全. <keycap>none</keycap>
                  不使用缓存.
                </entry>
                <entry>
                  默认值是 none, 如果设置了其它值, 虚拟机将不能迁移.
                </entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-4">
      <title>通过现成的模板复制虚拟机</title>
      <formalpara><title>摘要</title>
      <para>
        从模板克隆一个虚拟机和从模板创建一个虚拟机类似. 克隆出来的虚拟机拥有
        原先模板的一切内容, 包括同样的硬件配置, 同样的操作系统和应用软件等.
        但是当虚拟机被克隆之后, 它就不依赖于该模板了.
      </para>
      </formalpara>

      <procedure>
        <title>基于现成的模板克隆虚拟机</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>新建虚拟机</keycap>按钮, 打开<keycap>新建虚拟机</keycap>窗口.
          </para>
        </step>
        <step>
          <para>
            选择<keycap>集群</keycap>, 在<keycap>基于模板</keycap>下拉菜单中
            选择需要的模板.
          </para>
        </step>
        <step>
          <para>
            输入<keycap>名称</keycap>, <keycap>描述</keycap>, 和<keycap>注释</keycap>.
            其它保留默认(或者根据需要可以修改)
          </para>
        </step>
        <step>
          <para>
            点击<keycap>资源分配</keycap>标签, 在存储分配:模板 provisioning
            处, 选择<keycap>Thin</keycap>或者<keycap>克隆</keycap>.
          </para>
          <figure id="clone-vm-from-temp"><title>基于现成的模板克隆虚拟机</title>
          <mediaobject>
            <imageobject>
              <imagedata fileref="images/vm-clone-from-temp.png" format="PNG" scale="100"/>
            </imageobject>
          </mediaobject>
          </figure>
          <para>
            用户可以基于自己的需求选择不同的分配模式, 两种分配模式分别在磁盘
            的读写速度和占用空间上有所不同.
          </para>
          <itemizedlist>
	        <listitem>
	          <para>
                <keycap>Thin Provision</keycap>: 这种模式创建磁盘的速度很快,
                对存储的占用得很少. 它只在需要时候分配磁盘空间, 是一种按需分配的
                方式, 但是磁盘的读写速度比 Preallocated 慢, 这是默认的选项.
	          </para>
	        </listitem>
	        <listitem>
	          <para>
                <keycap>Preallocated</keycap>: 这种模式创建磁盘的速度很慢,
                对存储的占用得很多. 在创建的时候就分配了所需的所有磁盘空间, 优点是
                磁盘的读写速度比 Thin Provision 快.
	          </para>
	        </listitem>
          </itemizedlist>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>创建虚拟机.
          </para>
        </step>
      </procedure>

      <note>
        <para>
          克隆虚拟机会花很长时间, 因为它复制了整个模板的内容. 在此期间, 虚拟机
          处于镜像锁定状态.
        ￼        </para>
      </note>
      <formalpara><title>结果</title>
      <para>
        虚拟机已经创建好了, 在虚拟机列表下会显示出来, 用户可以开始使用这个虚拟机了.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-5">
      <title>定义虚拟网卡及建立磁盘，完成虚拟机设置</title>
      <formalpara><title>摘要</title>
      <para>
        虚拟机至少需要一个虚拟磁盘和虚拟网卡, 可以使用创建虚拟机时候弹出的
        <keycap>新建虚拟机 - 引导操作</keycap>窗口来完成这些操作.
      </para>
      </formalpara>

      <procedure>
        <title>定义虚拟网卡及建立磁盘, 完成虚拟机设置</title>
        <step>
          <para>
            在 <keycap>新建虚拟机 - 引导操作</keycap>窗口, 点击<keycap>网络接口</keycap>,
            打开<keycap>新建网络接口</keycap>窗口, 使用默认设置即可工作.
          </para>
          <figure id="vm-new-network-interface"><title>添加虚拟网络</title>
          <mediaobject>
            <imageobject>
              <imagedata fileref="images/vm-new-network-interface.png" format="PNG" scale="100"/>
            </imageobject>
          </mediaobject>
          </figure>
        </step>
        <step>
          <para>
            选择<keycap>配置</keycap>和<keycap>类型</keycap>, 设置网络接口的
            详细参数. 默认状态下<keycap>链路状态</keycap>是<keycap>Up</keycap>.
          </para>
        </step>
        <step>
          <para>
            如果想要设置 MAC 地址的话, 在<keycap>自定义的 MAC 地址</keycap>
            处设置给虚拟机的 MAC 地址.
          </para>
        </step>
        <step>
          <para>
            该窗口还允许设置设置<keycap>卡的状态</keycap>: <keycap>已插入</keycap>
            还是<keycap>已拔出</keycap>.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>创建网路接口, 打开<keycap>新建虚拟机 - 引导操作</keycap>窗口.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>配置虚拟磁盘</keycap>按钮, 打开<keycap>添加虚拟磁盘</keycap>窗口.
          </para>
        </step>
        <step>
          <para>
            添加一个<keycap>内部的</keycap>或者<keycap>外部(直接 LUN)</keycap>磁盘.
          </para>
          <figure id="vm-new-disk"><title>添加虚拟磁盘</title>
          <mediaobject>
            <imageobject>
              <imagedata fileref="images/vm-new-disk.png" format="PNG" scale="100"/>
            </imageobject>
          </mediaobject>
          </figure>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>创建创建虚拟磁盘. 至此, 虚拟机已经完成基本的
            设备的配置了.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>以后再配置</keycap>, 完成虚拟机的配置.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        通过上面的步骤, 已经向虚拟机添加了一个虚拟网卡和虚拟磁盘了.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-6">
      <title>为虚拟机安装操作系统</title>
      <formalpara><title>摘要</title>
      <para>
        从空白模板创建的虚拟机只有安装了操作系统才能正常使用, 可以给这种虚拟机
        安装任何 &OVIRT; 系统支持的操作系统.
      </para>
      </formalpara>

      <procedure>
        <title>为虚拟机安装操作系统</title>
        <step>
          <para>
            选择刚创建的虚拟机. 它目前的状态应该是 <keycap>Down</keycap>.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>只运行一次</keycap>, 打开<keycap>运行虚拟机窗口</keycap>.
          </para>
          <figure id="vm-run-once"><title>只运行一次</title>
          <mediaobject>
            <imageobject>
              <imagedata fileref="images/vm-run-once.png" format="PNG" scale="100"/>
            </imageobject>
          </mediaobject>
          </figure>
        </step>
        <step>
          <para>
            打开<keycap>引导选项</keycap>设置引导顺序, 并设置合适的引导盘(一般光盘引导).
          </para>
        </step>
        <step>
          <para>
            如果有需要, 点击 <keycap>Linux 引导选项</keycap>, 设置额外的 Linux
            虚拟机的启动选项.
          </para>
        </step>
        <step>
          <para>
            如果有需要, 点击<keycap>初始运行</keycap>, 设置 cloud-init 的参数.
          </para>
        </step>
        <step>
          <para>
            如果有需要, 点击<keycap>显示协议</keycap>, 选择需要的显示协议.
            这里, SPICE 是默认的显示协议, 并且是推荐的协议.
          </para>
        </step>
        <step>
          <para>
            如果有需要, <keycap>点击自定义属性</keycap>, 给虚拟机设置需要的
            其它属性.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>运行虚拟机.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        已经为裸虚拟机安装了操作系统, 现在, 用户可以登录到该系统开始使用该
        虚拟机了.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-7">
      <title>为分配了virtio硬件设备的虚拟机安装windows操作系统</title>
      <formalpara><title>摘要</title>
      <para>
        <keycap>virtio-win.vfd</keycap> 是一个软盘镜像, 包含了针对 Windows 的 virtio 磁盘和网络
        设备驱动, 使用这些能获得比传统的模拟设备更高的性能.
      </para>
      </formalpara>

      <para>
        用户可以使用 <keycap>engine-iso-uploader</keycap> 工具把该软盘镜像上传到
        ISO 存储域上.
      </para>

      <para>
        下面的步骤描述怎样在安装 Windows 的时候加载使用这些驱动, 前提是用户
        在配置虚拟机的时候, 已经添加了一个 VirtIO 的磁盘和网卡.
      </para>

      <procedure>
        <title>在安装 Windows 的时候, 加载 VirtIO 设备</title>
        <step>
          <para>
            在<keycap>虚拟机</keycap>列表中选择待安装系统的虚拟机.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>只运行一次</keycap>, 打开<keycap>运行虚拟机</keycap>窗口.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>引导选项</keycap>, 展开<keycap>引导选项</keycap>配置.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>附加软盘</keycap>, 从下拉菜单中选择<keycap>virtio-win.vfd</keycap>.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>附加 CD</keycap>, 从下拉菜单中选择你想要安装的 Windows
            ISO 镜像文件.
          </para>
        </step>
        <step>
          <para>
            在<keycap>引导序列</keycap>中, 把 <keycap>CD-ROM</keycap>移到最上面.
          </para>
        </step>
        <step>
          <para>
            配置其它想要配置的选项, 然后点击<keycap>确定</keycap>运行虚拟机,
            点击<keycap>控制台</keycap>连接到虚拟机开始安装.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        Windows 安装过程前, 包含一个加载额外驱动的步骤, 在这里, 选择该软盘驱动
        找到需要的驱动加载.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_4-8">
      <title>仅运行一次虚拟机的解释</title>
      <para>
        <keycap>只运行一次</keycap>定义了一些仅仅在这次运行的配置. 对于永久性
        的启动参数, 在<keycap>编辑虚拟机</keycap>的<keycap>引导选项</keycap>中
        配置.
      </para>
      <table id="VM_Run_Once_Setting">
        <title>只运行一次设置</title>
        <tgroup cols='2' align='left' colsep='1' rowsep='1'>
          <thead>
            <row>
              <entry>
                属性
              </entry>
              <entry>
                详细描述
              </entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>
                引导选项
              </entry>
              <entry>
                该选项可以让用户设置虚拟机的启动顺序, 启动参数, 安装操作系统
                需要的镜像和额外的驱动等.
                <itemizedlist>
	              <listitem>
	                <para>
                      <keycap>附加软盘</keycap> - 给虚拟机附加一个软盘镜像,
                      一般在安装 Windows 系统的时候使用. 该软盘镜像必须在 ISO
                      存储域里.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>附加 CD</keycap> - 给虚拟机附加一个 ISO 镜像,
                      用来给虚拟机安装操作系统时候使用. 该 CD 镜像必须在 ISO 存储域里.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>引导序列</keycap> - 定义虚拟机从哪个设备找到启动镜像.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>以 Stateless 状态运行</keycap> - 虚拟机关闭之后,
                      对磁盘做的任何修改将会被还原.
	                </para>
	              </listitem>
                  <listitem>
                    <para>
                      <keycap>以暂停模式启动</keycap> - 虚拟机最开始处于暂停状态.
                      对于需要准备很长时间才能建立 spice 连接的场景来说, 暂停模式很有用.
                      例如, 如果 spice client 和虚拟机运行的网络很远, 网络很慢的时候.
                    </para>
                  </listitem>
                </itemizedlist>
              </entry>
            </row>
            <row>
              <entry>
                Linux 引导选项
              </entry>
              <entry>
                设置了下列参数之后, 虚拟机直接启动一个 Linux 内核, 而不是从 BIOS
                加载启动镜像.
                <itemizedlist>
	              <listitem>
	                <para>
                      <keycap>内核路径</keycap> - 合法的内核镜像的路径. 内核镜像
                      必须存储在 ISO 域里(使用 iso://path-to-image 的格式), 或者
                      存储在主机的存储域里(使用/data/images)
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>initrd 路径</keycap> - 合法的 ramdisk 镜像的路径.
                      内核镜像必须存储在 ISO 域里(使用 iso://path-to-image 的格式),
                      或者存储在主机的存储域里(使用/data/images)
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>内核参数</keycap> - 内核启动时的参数
	                </para>
	              </listitem>
                </itemizedlist>
              </entry>
            </row>
            <row>
              <entry>
                初始运行
              </entry>
              <entry>
                允许用户使用 cloud-init, 并且定义这个虚拟机将使用到的一些设置.
                <itemizedlist>
	              <listitem>
	                <para>
                      <keycap>主机名</keycap> - 允许用户指定主机名.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>网络</keycap> - 允许用户配置网络, 包括网络接口
                      设置和 DNS 设置. 多个网络接口可以通过<keycap>新增</keycap>或者
                      <keycap>删除所选</keycap>来设置.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>SSH 授权密钥</keycap> - 允许用户指定添加到虚拟机的 SSH 密钥.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>重新生成 SSH 授权密钥</keycap> - 允许用户重新生成 SSH 密钥.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>时区</keycap> - 允许用户指定虚拟机运行的时区.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>根密码</keycap> - 允许用户设置虚拟机系统的 root 用户的密码.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>文件附件</keycap> - 允许用户注入普通文本或者 Base64
                      内容的文件到虚拟机内部. 文件的路径可以由用户指定. 多个文件可以通过
                      <keycap>新增</keycap>或者<keycap>删除所选</keycap>来设置.
	                </para>
	              </listitem>
                </itemizedlist>
              </entry>
            </row>
            <row>
              <entry>
                主机
              </entry>
              <entry>
                指定虚拟机运行的主机:
                <itemizedlist>
	              <listitem>
	                <para>
                      <keycap>群集里的任何主机</keycap> - 虚拟机可以运行在群集的任何主机上.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>专有的</keycap> - 用户指定一个主机来运行该虚拟机.
	                </para>
	              </listitem>
                </itemizedlist>
              </entry>
            </row>
            <row>
              <entry>
                显示协议
              </entry>
              <entry>
                设置连接虚拟机的显示协议:
                <itemizedlist>
	              <listitem>
	                <para>
                      <keycap>VNC</keycap> - 需要一个 VNC 客户端来连接.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>SPICE</keycap> - &OVIRT; 管理系统推荐使用的显示协议, 注意:
                      Windows 8 and Server 2012 不能使用此协议.
	                </para>
	              </listitem>
                </itemizedlist>
              </entry>
            </row>
            <row>
              <entry>
                自定义属性
              </entry>
              <entry>
                可以传递给 VDSM 的额外属性.
                <itemizedlist>
	              <listitem>
	                <para>
                      <keycap>sap_agent</keycap> - 设置 SAP 监控.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>sndbuf</keycap> - 设置虚拟机套接字的发送缓存大小, 默认值是 0.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>vhost</keycap> - 可以将vhost-net 禁用掉, vhost-net
                      是在主机的 virtio 网络驱动, 可以提高虚拟机的网络性能.
	                </para>
	              </listitem>
	              <listitem>
	                <para>
                      <keycap>viodiskcache</keycap> - 设置 virtio 磁盘的缓存模式.
                      <keycap>writethrough</keycap> 同时把数据写到缓存和磁盘中才返回, 性能较低.
                      <keycap>writeback</keycap> 将数据写入到缓存中就返回, 性能较高,
                      但是不能保证数据安全. <keycap>none</keycap>不使用缓存.
	                </para>
	              </listitem>
                </itemizedlist>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
  </section>

  <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_5">
    <title>使用虚拟机</title>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_5-1">
      <title>SPICE</title>
      <para>
        SPICE(Simple Protocol for Independent Computing Environments) 协议主要
        是用来为用户提供一个图形化的访问虚拟机的方式, 它有以下特点:
      </para>

      <itemizedlist>
        <listitem>
          <para>
            支持超过 30FPS(Frames Per Second) 的视频播放
          </para>
        </listitem>

        <listitem>
          <para>
            双向音频
          </para>
        </listitem>

        <listitem>
          <para>
            双向视频
          </para>
        </listitem>

        <listitem>
          <para>
            同一个虚拟机支持多个虚拟显示器连接
          </para>
        </listitem>

        <listitem>
          <para>
            支持重定向客户端的 USB 端口到虚拟机里面
          </para>
        </listitem>

        <listitem>
          <para>
            支持通过代理连接 SPICE 协议 <!--TODO-->
          </para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_5-2">
      <title>启动虚拟机</title>
      <formalpara><title>摘要</title>
      <para>
        可以通过管理员门户启动一个虚拟机.
      </para>
      </formalpara>

      <procedure>
        <title>启动虚拟机</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要开启
            的虚拟机. 目前他的状态是 <keycap>Down</keycap>.
          </para>
        </step>
        <step>
          <para>
            点击开机按钮.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟机的状态变为 <keycap>Up</keycap>. 虚拟机的显示协议会被显示
        出来(VNC 或者 SPICE). 如果在虚拟机内部安装了 <keycap>ovirt-guest-agent</keycap>,
        那么虚拟机的 IP 地址和安装的应用程序也会显示出来.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_5-3">
      <title>为windows/linux安装SPICE的浏览器插件</title>
      <para>
        SPICE 协议默认的连接显示虚拟机的协议. 如果用户使用 Firefox 和 IE 浏览器
        访问用户, 那么可以直接从门户通过浏览器的插件直接连接虚拟机.
      </para>
      <formalpara><title>摘要</title>
      <para>
        以下步骤描述了在 Linux 客户端下为 Firefox 浏览器安装 SPICE 插件的过程.
      </para>
      </formalpara>

      <procedure>
        <title>为 Firefox 浏览器安装 SPICE 插件</title>
        <step>
          <para>
            打开终端, 以 root 用户运行
          </para>
          <programlisting language="Bash">
# yum install nfs-utils
          </programlisting>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        插件将会安装到合适的目录, 重启 Firefox, 就可以直接在门户通过
        SPICE 连接虚拟机了.
      </para>
      </formalpara>

      <formalpara><title>摘要</title>
      <para>
        以下步骤描述了在 Windows 客户端下为 IE 浏览器安装 SPICE 插件的过程.
      </para>
      </formalpara>

      <procedure>
        <title>为 IE 浏览器安装 SPICE 插件</title>
        <step>
          <para>
            用户第一次连接虚拟机的时候, 会有一个提示显示在浏览器上, 提示用户安装
            SPICE ActiveX 插件. 当前用户必须有超级管理用户权限才能安装, 如果
            没有, 请联系管理员帮忙安装
          </para>
        </step>
        <step>
          <para>
            安装 SPICE ActiveX 插件的时候, IE 浏览器会弹出一个安全警告. 确定你要
            安装之后, 该插件将会被安装.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        IE 浏览器的 SPICE ActiveX 插件将会被安装到该系统上.
      </para>
      </formalpara>
      <important>
        <para>
          如果用户没有使用超级管理员权限安装 IE 的 SPICE 插件, 那么用户会得到
          一个警告: usbclerk 将不会被安装. 如果没有安装 usbclerk, 那么用户
          可以正常使用 SPICE 连接虚拟机, 除了用户不能在虚拟机里使用 USB 设备.
          如果用户需要使用 USB 设备, 请联系系统管理员安装它.
        </para>
      </important>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_5-4">
      <title>登录到虚拟机</title>
      <formalpara><title>摘要</title>
      <para>
        默认的连接显示虚拟机的协议是 SPICE. 用户可以在管理门户通过 SPICE 协议
        直接连接虚拟机. 如果虚拟机被设置为使用 VNC 协议, 那么用户需要一个 VNC
        客户端来连接虚拟机.
      </para>
      </formalpara>

      <procedure>
        <title>登陆到虚拟机</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要连接
            的虚拟机. 目前他的状态是 <keycap>Up</keycap>.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>控制台</keycap>按钮, 或者右键点击虚拟机,
            选择<keycap>控制台</keycap>.
          </para>
          <figure id="vm-console"><title>控制台</title>
          <mediaobject>
            <imageobject>
              <imagedata fileref="images/vm-console.png" format="PNG" scale="100"/>
            </imageobject>
          </mediaobject>
          </figure>          
        </step>
        <step>
          <para>
            A. 如果虚拟机的显示协议是 SPICE, 那么将会打开一个 SPICE 的窗口,
            用户可以用这个窗口访问虚拟机.
          </para>
          <para>
            B. 如果虚拟机的显示协议是 VNC, 用户将会被提示下载一个名为 "vonsole.vv"
            的文件. 这个文件包含了用户用 VNC 客户端登陆虚拟机的所有信息.
            使用文本编辑器打开该文件, 然后使用 VNC 客户端加上文件里的信息访问
            虚拟机.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        用户可以通过控制台直接从浏览器访问虚拟机.
      </para>
      </formalpara>
    </section>
  </section>
  <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_6">
    <title>关闭或暂停虚拟机</title>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_6-1">
      <title>关闭或暂停虚拟机</title>
      <para>
        用户在登陆进虚拟机之后, 能从虚拟机里面关机. 但是有时候也需要从管理门户
        关闭该虚拟机.
      </para>

      <para>
        &OVIRT; 管理系统提供了很优雅的关闭虚拟机的方式, 如果虚拟机安装了
        guest tools, 那么这种方式就可以用来从管理门户关闭虚拟机. 从门户端
        关闭虚拟机应该是要有计划的, 至少应该保证在不能影响用户使用的情况下关闭.
      </para>

      <para>
        在关闭 Windows 虚拟机的时候, 所有的用户都必须登出该虚拟机. 如果有用户
        还在登陆中, 那么该虚拟机在界面中将会显示 <keycap>Powering Off</keycap>
        状态. 此时如果需要关闭虚拟机, 那么用户必须手动连接进虚拟机, 因为 Windows
        一直提示以下信息:
      </para>
      <para>
        Other people are logged on to this computer. Shutting down Windows might
        cause them to lose data. Do you want to continue shutting down?
      </para>

      <para>
        如果管理员不能优雅的关闭虚拟机, 比如虚拟机失去响应. 这个时候管理员还可以
        强制关闭该虚拟机, 点击界面上的<keycap>断电</keycap>按钮来强制结束.
      </para>

      <warning>
        <para>
          把虚拟机断电的时候要小心, 因为这样会丢失虚拟机内部的数据.
        </para>
      </warning>

      <para>
        暂停一个虚拟机会使得该虚拟机进入冬眠模式, 该模式下虚拟机的状态将被保存.
        运行中的应用程序数据会写入到硬盘中保存, 此时 CPU 使用率将为 0.
      </para>
    </section>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_6-2">
      <title>关闭虚拟机</title>
      <formalpara><title>摘要</title>
      <para>
        如果虚拟机安装了 <keycap>ovirt-guest-agent</keycap>, 或者配置了高级电源
        管理, 那么用户可以从管理员门户优雅的关闭该虚拟机.
      </para>
      </formalpara>

      <procedure>
        <title>关闭虚拟机</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要连接
            的虚拟机. 目前他的状态是 <keycap>Up</keycap>.
          </para>
        </step>
        <step>
          <para>
            右击该虚拟机, 点击<keycap>关闭</keycap>来关闭该虚拟机.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟机的<keycap>状态</keycap>变为<keycap>Down</keycap>.
      </para>
      </formalpara>            
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_6-3">
      <title>暂停虚拟机</title>
      <para>
      </para>
      <formalpara><title>摘要</title>
      <para>
        如果虚拟机安装了 <keycap>ovirt-guest-agent</keycap>, 或者配置了高级电源
        管理, 那么用户可以从管理员门户暂停该虚拟机. 该虚拟机将会进入休眠模式.
      </para>
      </formalpara>

      <procedure>
        <title>暂停虚拟机</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要连接
            的虚拟机. 目前他的状态是 <keycap>Up</keycap>.
          </para>
        </step>
        <step>
          <para>
            右击该虚拟机, 点击<keycap>挂起</keycap>来暂停该虚拟机.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟机的<keycap>状态</keycap>变为<keycap>Suspended</keycap>.
      </para>
      </formalpara>      
      <para>
      </para>
    </section>
  </section>

  <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_7">
    <title>管理虚拟机</title>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_7-1">
      <title>编辑资源</title>
      <formalpara><title>摘要</title>
      <para>
        编辑资源的属性.
      </para>
      </formalpara>

      <procedure>
        <title>编辑资源</title>
        <step>
          <para>
            使用资源标签, 搜索标签等找到想要的资源.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>编辑</keycap>打开<keycap>编辑窗口</keycap>.
          </para>
        </step>
        <step>
          <para>
            改变资源的属性, 点击<keycap>确定</keycap>.
          </para>
        </step>
      </procedure>
      <formalpara><title>结果</title>
      <para>
        该资源属性的值将会被保存.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_7-2">
      <title>删除虚拟机</title>
      <formalpara><title>摘要</title>
      <para>
        用户不再需要该虚拟机的时候, 可以把它从数据中心删除掉. 删除虚拟机的时候
        必须先把该虚拟机暂停.
      </para>
      </formalpara>

      <procedure>
        <title>删除虚拟机</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要连接
            的虚拟机.
          </para>
        </step>
        <step>
          <para>
           <keycap>删除</keycap>按钮只在虚拟机处于<keycap>Down</keycap>状态
           才会可用.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>删除</keycap>, 在<keycap>删除虚拟机窗口</keycap>, 如果
            想要把虚拟机使用的磁盘也一并删除, 那么勾选<keycap>删除磁盘</keycap>.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>删除该虚拟机.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟机将会被删除, 将会从虚拟机列表里消失.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_7-3">
      <title>添加、编辑虚拟磁盘</title>
      <formalpara><title>摘要</title>
      <para>
        &OVIRT; 管理系统允许用户给虚拟机添加新的磁盘. 用户可以给虚拟机添加新的
        磁盘, 或者把之前创建的浮动磁盘分配给虚拟机. 用户也可以创建虚拟机之间可以
        共享的磁盘. 或者编辑磁盘的属性.

        默认情况下, 创建的磁盘类型是内部磁盘. 用户也可以直接增加外部的磁盘.
        内部磁盘被 &OVIRT; 管理系统管理. 用户要使用外部磁盘, 必须先把该磁盘(LUN)
        的 target 增加到系统里. 创建的磁盘可以是共享的, 或者是浮动的.
      </para>
      </formalpara>

      <procedure>
        <title>给虚拟机添加磁盘</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要连接
            的虚拟机.
          </para>
        </step>
      <step>
        <para>
          在详细信息面板上, 点击<keycap>磁盘</keycap>, 将会显示附加到该虚拟机
          上的所有磁盘.
        </para>
      </step>
        <step>
          <para>
            点击<keycap>添加</keycap>, 打开<keycap>添加磁盘</keycap>窗口.
          </para>
          <figure id="vm-add-disk"><title>给虚拟机添加磁盘</title>
          <mediaobject>
            <imageobject>
              <imagedata fileref="images/vm-add-disk.png" format="PNG" scale="100"/>
            </imageobject>
          </mediaobject>
          </figure>
        </step>
        <step>
          <para>
            在<keycap>内部的</keycap>和<keycap>外部(直接 LUN)</keycap>之间来
            选择要添加的磁盘类型.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>附加磁盘</keycap>, 选择要添加的磁盘. 或者直接创建
            一个新的磁盘附加给虚拟机.
          </para>
        </step>
        <step>
          <para>
            点击窗口又下角的<keycap>确定</keycap>给虚拟机分配浮动磁盘.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        我们已经给虚拟机分配给了新的磁盘, 在虚拟机的磁盘列表上会被列出来.
      </para>
      </formalpara>
    </section>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_7-4">
      <title>添加、编辑虚拟网卡</title>
      <formalpara><title>摘要</title>
      <para>
        用户可以给虚拟机添加网络接口使得虚拟机有多块网卡. 用户也编辑已经添加
        的网卡, 更新网卡的某些属性. 下面描述的步骤可以在虚拟机运行的时候执行,
        但是某些操作必须要虚拟机关机才能执行.
      </para>
      </formalpara>

      <procedure>
        <title>给虚拟机添加网络接口</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要连接
            的虚拟机.
          </para>
        </step>
        <step>
          <para>
            在下面的虚拟机详细信息面板上选择<keycap>网络接口</keycap>列出目前
            附加到该虚拟机下的网络接口.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>新建</keycap>, 打开<keycap>新建网络接口</keycap>窗口.
          </para>
          <figure id="vm-new-network-interface2"><title>添加虚拟网络</title>
          <mediaobject>
            <imageobject>
              <imagedata fileref="images/vm-new-network-interface.png" format="PNG" scale="100"/>
            </imageobject>
          </mediaobject>
          </figure>
        </step>
        <step>
          <para>
            输入网卡的<keycap>名称</keycap>.
          </para>
        </step>
        <step>
          <para>
            选择<keycap>配置</keycap>和<keycap>类型</keycap>, 设置网络接口的
            详细参数. 默认状态下<keycap>链路状态</keycap>是<keycap>Up</keycap>.
          </para>
        </step>
        <step>
          <para>
            如果想要设置 MAC 地址的话, 在<keycap>自定义的 MAC 地址</keycap>
            处设置给虚拟机的 MAC 地址.
          </para>
        </step>
        <step>
          <para>
            该窗口还允许设置设置<keycap>卡的状态</keycap>: <keycap>已插入</keycap>
            还是<keycap>已拔出</keycap>.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>创建网路接口.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        我们已经给虚拟机添加了新的网络接口, 在虚拟机的<keycap>网络接口</keycap>
        列表上会被列出来.
      </para>
      </formalpara>
    </section>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_7-5">
      <title>虚拟机网卡设置窗口配置解释</title>
      <para>
        下表详细解释了在新建或者编辑虚拟网络接口的时候使用到的属性. 用户可以给
        一个虚拟机添加多个网卡, 这样虚拟机就处于多网卡模式了.
      </para>
      <table id="VM_Network_Setting">
        <title>网络接口的属性</title>
        <tgroup cols='2' align='left' colsep='1' rowsep='1'>
          <thead>
            <row>
              <entry>
                属性
              </entry>
              <entry>
                详细描述
              </entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>
                <keycap>名称</keycap>
              </entry>
              <entry>
                网络接口的名称, 必须限制在 21 个字符之类, 可以由大小写字母, 数字,
                下划线和连字符组成.
              </entry>
            </row>
            <row>
              <entry>
                <keycap>配置</keycap>
              </entry>
              <entry>
                虚拟网络所处的的主机的逻辑网络名字. 模型情况下, 所有虚拟机网络
                接口都放在 ovirtmgmt 下.
              </entry>
            </row>
            <row>
              <entry>
                <keycap>链路状态</keycap>
              </entry>
              <entry>
                是否该网络接口连接到了逻辑网络上.
                <itemizedlist>
                  <listitem>
                    <para>
                      Up:
                    </para>
                    <itemizedlist>
                      <listitem>
                        <para>
                          当网卡的状态是已插入时, 意味着网络接口已经连接到逻辑
                          网络上了, 处于激活状态.
                        </para>
                      </listitem>
                    </itemizedlist>
                    <itemizedlist>
                      <listitem>
                        <para>
                          当网卡的状态是已拔出时, 意味着网卡变为已插入时,
                          网络接口将会自动连接和激活
                        </para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>
                      Down: 网口接口没有连接到任何网络. 这种状态下虚拟机将不能使用该网络接口.
                    </para>
                  </listitem>
                </itemizedlist>
              </entry>
            </row>
            <row>
              <entry>
                <keycap>类型</keycap>
              </entry>
              <entry>
                虚拟网卡的类型. 有三种类型, VirtIO. rtl8139 和 e1000. VirtIO
                是最快的虚拟网卡类型, 但是使用该网卡需要额外的 VirtIO 驱动.
                大部分 Linux 操作系统都自带 VirtIO 的驱动. Windows 没有包含
                VirtIO 驱动, 但是用户可以通过 guest tools ISO
                或者虚拟软盘来安装. 另外两种类型的网卡已经包含在大部分操作系统里了.
              </entry>
            </row>
            <row>
              <entry>
                <keycap>自定义的 MAC 地址</keycap>
              </entry>
              <entry>
                用户可以在这里设置网络接口的 MAC 地址. 如果用户没有选择的话,
                &OVIRT; 管理系统会为该网卡自动选择一个独立的 MAC 地址. 请注意
                如果两个虚拟网卡有相同的 MAC 地址, 那么使用这两个网卡的时候会
                发生网络异常.
              </entry>
            </row>
            <row>
              <entry>
                <keycap>卡的状态</keycap>
              </entry>
              <entry>
                是否把网络接口插入该虚拟机.
                <itemizedlist>
                  <listitem>
                    <para>
                      <keycap>已插入</keycap>: 该网络接口已经插入该虚拟机
                    </para>
                    <itemizedlist>
                      <listitem>
                        <para>
                          如果 <keycap>链路状态</keycap> 是 <keycap>Up</keycap>,
                          那么此网卡已经正确连接到逻辑网络了, 并且已激活可用
                        </para>
                      </listitem>
                      <listitem>
                        <para>
                          如果 <keycap>链路状态</keycap> 是 <keycap>Down</keycap>,
                          那么此网卡没有连接到逻辑网络.
                        </para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para>
                      <keycap>已拔出</keycap>: 该网络接口只在 &OVIRT; 中定义,
                      没有插入该虚拟机
                    </para>
                    <itemizedlist>
                      <listitem>
                        <para>
                          如果 <keycap>链路状态</keycap> 是 <keycap>Up</keycap>,
                          当网卡被插入时, 该网络接口将自动连接到逻辑网络
                        </para>
                      </listitem>
                      <listitem>
                        <para>
                          如果 <keycap>链路状态</keycap> 是 <keycap>Down</keycap>,
                          该网络接口没有连接到逻辑网络, 知道网卡插入时
                        </para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                </itemizedlist>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_7-6">
      <title>热插拔虚拟磁盘</title>
      <formalpara><title>摘要</title>
      <para>
        &OVIRT; 系统允许用户热插拔磁盘. 热插拔允许在虚拟机运行的时候动态的添加
        或者删除磁盘.
      </para>
      </formalpara>

      <procedure>
        <title>热插拔磁盘</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要连接
            的虚拟机.
          </para>
        </step>
        <step>
          <para>
            从显示的虚拟机详细面板中选择<keycap>磁盘</keycap>标签.
          </para>
        </step>
        <step>
          <para>
            选择想要热插拔的磁盘.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>激活</keycap>或者<keycap>取消激活</keycap>按钮.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        磁盘的会从虚拟机动态添加或者删除.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_7-7">
      <title>热插拔虚拟网卡</title>
      <formalpara><title>摘要</title>
      <para>
        &OVIRT; 系统允许用户热插拔虚拟网卡. 热插拔允许在虚拟机运行的时候动态的添加
        或者删除虚拟网卡.
      </para>
      </formalpara>

      <procedure>
        <title>热插拔网卡</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要连接
            的虚拟机.
          </para>
        </step>
        <step>
          <para>
            从显示的虚拟机详细面板中选择<keycap>网络接口</keycap>标签.
          </para>
        </step>
        <step>
          <para>
            选择想要热插拔的磁盘, 点击<keycap>编辑</keycap>按钮, 打开
            <keycap>网络接口</keycap>窗口.
          </para>
        </step>
        <step>
          <para>
            如果想要热添加网卡, 选中<keycap>已插入</keycap>, 如果想要热删除
            网卡, 选择<keycap>已拔出</keycap>.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟网卡的会从虚拟机动态添加或者删除.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_7-8">
      <title>从虚拟机中删除磁盘或网卡</title>
      <formalpara><title>摘要</title>
      <para>
        用户可以将虚拟机里的虚拟磁盘和网卡删除. 如果选择删除磁盘, 那么磁盘的
        数据将会被删除.
      </para>
      </formalpara>

      <para>
        这和热删除磁盘和网卡不同, 只有处于<keycap>非激活</keycap>状态的磁盘和网卡才能被删除.
      </para>

      <procedure>
        <title>从虚拟机中删除磁盘或网卡</title>
        <step>
          <para>
            选择你要操作的虚拟机.
          </para>
        </step>
        <step>
          <para>
            选择相关的资源, 比如<keycap>磁盘或者</keycap>或者是
            <keycap>网络接口</keycap>.
          </para>
        </step>
        <step>
          <para>
            选择需要删除的资源. 首先该资源必须处于<keycap>非激活</keycap>状态.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>删除</keycap>按钮. 在弹出的确认窗口中选择
            <keycap>确定</keycap>. 如果删除的资源是磁盘, 选择
            <keycap>永久的删除</keycap>单选框彻底删除磁盘, 如果只是想从该虚拟机
            删除该磁盘, 想要保留磁盘, 比如如果该磁盘是共享, 那么不要选择该选项.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟磁盘或者网卡会从虚拟机里删除.
      </para>
      </formalpara>
    </section>
  </section>

  <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_8">
    <title>虚拟机和权限</title>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_8-1">
      <title>为虚拟机管理系统权限</title>
      <para>
        系统管理员，在 &OVIRT; &MANAGER;中称作 <emphasis>SuperUser</emphasis>，能够对管理员门户中的所有模块进行管理。更为精细的管理员角色可以分配给其他用户。这些只能进行部分系统管理功能的角色，能够分配给一个用户使得该用户拥有对于特定资源一定的管理权限：例如 <emphasis>DataCenterAdmin</emphasis> 角色对于分配的数据中心具有管理员权限，<emphasis>StorageAdmin</emphasis> 角色对于分配的存储域具有管理员权限，以此类推。
      </para>
      <para>
        <emphasis>UserVmManager</emphasis> 是对数据中心中的虚拟机的系统管理员角色。该角色能够被应用到特定的虚拟机、数据中心或者整个虚拟化环境。这使得不同的用户能够在不同的级别上管理特定的虚拟资源。
      </para>
      <para>
        <emphasis>UserVmManager</emphasis> 角色能够进行以下操作：
      </para>
      <itemizedlist>
        <listitem>
          <para>
            创建、编辑和删除虚拟机；还有
          </para>
        </listitem>
        <listitem>
          <para>
            运行、挂起、停止以及断开虚拟机电源。
          </para>
        </listitem>
      </itemizedlist>
      <note>
        <para>
          您只可以分配角色和权限到已存在的用户上。
        </para>
      </note>
      <para>
        在虚拟化环境中，很多终端用户被认为只与虚拟机资源打交道。因此，&OVIRT; 提供了一些用户角色，使得用户能够管理虚拟机，而不能管理数据中心中的其它资源。
      </para>
      <para>
        <emphasis>参见：</emphasis>
      </para>
      <itemizedlist>
        <listitem>
          <simpara>
            <xref linkend="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_8-2"/>
          </simpara>
        </listitem>
      </itemizedlist>
    </section>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_8-2">
      <title>虚拟机管理员角色解释</title>
      <formalpara>
        <title>虚拟机管理员权限角色</title>
        <para>
          以下表格描述了虚拟机管理中的管理员角色和其相应的权限。
        </para>
      </formalpara>
      <table>
        <title>&OVIRT; 系统管理员角色</title>
        <tgroup cols="3" align="left" colsep="1" rowsep="1">
          <thead>
            <row>
              <entry>
                角色
              </entry>
              <entry>
                权限
              </entry>
              <entry>
                说明
              </entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>
                DataCenterAdmin
              </entry>
              <entry>
                数据中心管理员
              </entry>
              <entry>
                能够使用、创建、删除、管理数据中心中的所有虚拟机。
              </entry>
            </row>
            <row>
              <entry>
                ClusterAdmin
              </entry>
              <entry>
                集群管理员
              </entry>
              <entry>
                能够使用、创建、删除、管理集群中的所有虚拟机。
              </entry>
            </row>
            <row>
              <entry>
                NetworkAdmin
              </entry>
              <entry>
                网络管理员
              </entry>
              <entry>
                能够配置和管理连接到虚拟机的网络。要在虚拟机网络中配置端口镜像功能，请同时在网络上应用 <emphasis>NetworkAdmin</emphasis> 角色和在虚拟机上应用 <emphasis>UserVmManager</emphasis> 角色到同一个用户。
              </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      <para>
        <emphasis>参见：</emphasis>
      </para>
      <itemizedlist>
        <listitem>
          <simpara>
            <xref linkend="sect-Users_and_Roles-User_and_Administrator_Roles"/>
          </simpara>
        </listitem>
      </itemizedlist>
    </section>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_8-3">
      <title>虚拟机用户角色解释</title>
      <formalpara>
        <title>虚拟机用户权限角色</title>
        <para>
          以下表格描述了虚拟机用户的用户角色及其相应的权限。这些角色允许登录用户门户对虚拟机进行管理及使用，但他们在管理员门户不具有任何权限。
        </para>
      </formalpara>
      <table>
        <title>&OVIRT; 系统用户角色</title>
        <tgroup cols="3" align="left" colsep="1" rowsep="1">
          <thead>
            <row>
              <entry>
                角色
              </entry>
              <entry>
                权限
              </entry>
              <entry>
                说明
              </entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>
                UserRole
              </entry>
              <entry>
                能够使用虚拟机及虚拟机池。
              </entry>
              <entry>
                能够登录到用户门户并使用虚拟机及虚拟机池。
              </entry>
            </row>
            <row>
              <entry>
                PowerUserRole
              </entry>
              <entry>
                能够创建和管理虚拟机及模板。
              </entry>
              <entry>
                使用<emphasis>配置</emphasis>窗口在整个系统之上将此角色应用于一个用户，或者为特定的数据中心、集群应用此角色。例如，如果 PowerUserRole 角色在数据中心层次上应用于用户上，该用户能够在该数据中心内创建及管理虚拟机和模板。
              </entry>
            </row>
            <row>
              <entry>
                UserVmManager
              </entry>
              <entry>
                虚拟机的系统管理员。
              </entry>
              <entry>
                能够管理虚拟机，创建和使用快照，以及迁移虚拟机。创建虚拟机的用户将会在该虚拟机上被自动分配 UserVmManager 角色。
              </entry>
            </row>
            <row>
              <entry>
                UserTemplateBasedVm
              </entry>
              <entry>
                受限制的权限，只能够使用模板。
              </entry>
              <entry>
                能够基于模板创建虚拟机。
              </entry>
            </row>
            <row>
              <entry>
                VmCreator
              </entry>
              <entry>
                能够在用户门户创建虚拟机。
              </entry>
              <entry>
                该角色并不应用于特定的虚拟机之上；您应该使用<emphasis>配置</emphasis>窗口为整个系统应用该角色到一个用户。当应用该角色到一个集群上时，您必须对整个数据中心或者特定的存储域应用 <emphasis>DiskCreator</emphasis> 角色。
              </entry>
            </row>
            <row>
              <entry>
                NetworkUser
              </entry>
              <entry>
                虚拟机的逻辑网络和网络接口的用户。
              </entry>
              <entry>
                如果在逻辑网络创建时勾选了<emphasis>允许所有用户使用此网络</emphasis>，在该逻辑网络上的 <emphasis>NetworkUser</emphasis> 将会被分配到所有的用户上。之后用户能够在该逻辑网络上连接或者分离虚拟机的网络接口。
              </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      <para>
        <emphasis>参见：</emphasis>
      </para>
      <itemizedlist>
        <listitem>
          <simpara>
            <xref linkend="sect-Users_and_Roles-User_and_Administrator_Roles"/>
          </simpara>
        </listitem>
      </itemizedlist>
    </section>
    <xi:include href="sect-Assigning_an_Administrator_or_User_Role_to_a_Resource.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="sect-Removing_an_Administrator_or_User_Role_from_a_Resource.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
  </section>
  <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_9">
    <title>使用快照来备份、恢复虚拟机</title>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_9-1">
      <title>为虚拟机创建快照</title>
      <formalpara><title>摘要</title>
      <para>
        快照, 指的是在某个时间点将虚拟机的所有数据都保存. 包括操作系统, 应用程序
        以及数据. 便于日后可以恢复到这个时间的这个状态. 快照本身会将虚拟镜像保存
        为一个 COW 的文件或卷, 当然并不是复制镜像, 而是基于原来的加上一个新的
        COW层. 所有变化的数据是存放在新的COW层里的. 用户可以使用快照将虚拟机
        恢复到原先的状态.
      </para>
      </formalpara>

      <procedure>
        <title>为虚拟机创建快照</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要连接
            的虚拟机.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>创建</keycap>, 打开<keycap>创建快照</keycap>窗口
          </para>
        </step>
        <step>
          <para>
            输入快照的<keycap>描述</keycap>.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>创建快照.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        快照开始创建的时候, 它的状态是<keycap>Locked</keycap>, 当快照创建完成
        之后, 它的状态变为<keycap>Ok</keycap>. 用户点击某一个快照时, 该快照里面
        包含的常规信息, 磁盘信息, 网络接口信息, 已安装的应用程序信息都会显示出来.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_9-2">
      <title>使用快照恢复虚拟机</title>
      <para>
        快照可以用来恢复虚拟机到之前的状态.
      </para>
      <procedure>
        <title>使用快照恢复虚拟机</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要连接
            的虚拟机, 确保虚拟机处于<keycap>关机</keycap>状态.
          </para>
        </step>
        <step>
          <para>
            在详细信息面板上, 点击<keycap>快照</keycap>, 将会显示该虚拟机
            的所有快照.
          </para>
        </step>
        <step>
          <para>
            选择要恢复的快照.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>预览</keycap>进入预览模式.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>提交</keycap>把快照提交到虚拟机.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟机将会被恢复到创建快照时的时间点.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_9-3">
      <title>从快照中创建虚拟机</title>
      <formalpara><title>摘要</title>
      <para>
        用户可以使用之前创建的快照克隆一个虚拟机.
      </para>
      </formalpara>

      <procedure>
        <title>从快照创建虚拟机</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要连接
            的虚拟机.
          </para>
        </step>

        <step>
          <para>
            在详细信息面板上, 点击<keycap>快照</keycap>, 将会显示该虚拟机
            的所有快照.
          </para>
        </step>

        <step>
          <para>
            鼠标单击需要的快照, 然后点击<keycap>克隆</keycap>,
            打开<keycap>从快照克隆虚拟机</keycap>窗口, 如图:
          </para>
        </step>

        <step>
          <para>
            输入需要的<keycap>名称</keycap>, <keycap>描述(可选)</keycap>,
            <keycap>注释(可选)</keycap>
          </para>
          <figure id="vm-clone-from-snapshot"><title>从克隆快照窗口</title>
          <mediaobject>
            <imageobject>
              <imagedata fileref="images/vm-clone-from-snapshot.png" format="PNG" scale="100"/>
            </imageobject>
          </mediaobject>
          </figure>
        </step>
        <step>
          <para>
            点击窗口又下角的<keycap>确定</keycap>克隆虚拟机.
          </para>
        </step>
      </procedure>

    </section>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_9-4">
      <title>删除快照</title>
      <formalpara><title>摘要</title>
      <para>
        永久删除一个快照.
      </para>
      </formalpara>

      <procedure>
        <title>删除快照</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要连接
            的虚拟机.
          </para>
        </step>
        <step>
          <para>
            在详细信息面板上, 点击<keycap>快照</keycap>, 将会显示该虚拟机
            的所有快照.
          </para>
        </step>
        <step>
          <para>
            选择要删除的<keycap>快照</keycap>.
          </para>
        </step>
        <step>
          <para>
            关闭关联词快照的所有运行着的虚拟机.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>删除</keycap>, 打开<keycap>删除快照</keycap>窗口.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>删除快照.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟机的该快照将会被删除. 删除快照并不会影响该虚拟机的使用.
      </para>
      </formalpara>
    </section>
  </section>
  <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_10">
    <title>导入/导出虚拟机</title>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_10-1">
      <title>导出和导入虚拟机</title>
      <para>
        在 &OVIRT; 系统中, 虚拟机和模板可以在不同的数据中心之间移动, 更进一步,
        它们甚至可以在不同的 &OVIRT; 环境中移动. &OVIRT; 管理系统用于用户导入
        导出 OVF(Open Virtual Machine Format) 格式的模板和虚拟机. 该功能
        一般用于以下场景中:
        <itemizedlist>
	      <listitem>
	        <para>
              在不同的 &OVIRT; 环境中移动虚拟机资源.
	        </para>
	      </listitem>
	      <listitem>
	        <para>
              在同一个 &OVIRT; 环境的不同数据中心之间移动虚拟机资源.
	        </para>
	      </listitem>
	      <listitem>
	        <para>
              备份虚拟机镜像和模板.
	        </para>
	      </listitem>
        </itemizedlist>
      </para>

      <para>
        要完成上述功能, 需要三步:
        <itemizedlist>
	      <listitem>
	        <para>
              首先导出虚拟机镜像和模板到导出域.
	        </para>
	      </listitem>
	      <listitem>
	        <para>
              然后将该导出域从所在的数据中心分离, 然后附加到另外一个数据中上.
              可以将导出域附加到同一个 &OVIRT; 系统中的不同数据中心上, 或者附加到
              另一个 &OVIRT; 管理系统中的数据中心上.
	        </para>
	      </listitem>
	      <listitem>
	        <para>
              把虚拟机和磁盘导入到新附加的数据中心上.
	        </para>
	      </listitem>
        </itemizedlist>

        在数据中心之间移动虚拟机的时候, 虚拟机必须处于关机状态. 如果虚拟机从
        模板创建的, 那么创建虚拟机的模板也必须处于目的数据中心里, 或者导出虚拟机
        的时候选中 <keycap>Collapse 快照</keycap> 选项.
      </para>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_10-2">
      <title>导入/导出进程概览</title>
      <para>
        导出域允许用户在不同的数据中心之间移动虚拟机和模板.
      </para>

      <para>
        为了导入或者导出虚拟机资源, 一个导出域必须要附加到数据中心中, 而且处于
        激活状态. 导出域是一个临时的存储域, 里面有两个目录包含了导出的虚拟资源.
        一个包含了所有虚拟机的 OVF 信息, 另一个包含了虚拟机镜像.
      </para>

      <para>
        用户可以从其它地方导入虚拟机, 比如从 Xen, VMware 或者 windows 平台
        导入虚拟机, 该过程可以使用 V2V 工具来完成.
      </para>

      <para>
        更多 V2V 工具的使用, 请参考 V2V 手册.
      </para>

      <note>
        <para>
          同一时刻, 一个导出域只能附加到一个数据中心中. 但是导出于即可附加到
          源数据中心, 也可附加到目的数据中心.
        </para>
      </note>

      <para>
        为了正常使用导出域, 需要满足以下的几个条件:
        <itemizedlist>
          <listitem>
            <para>
              一个附加到源数据中心的导出域.
            </para>
          </listitem>
          <listitem>
            <para>
              所有要导出的虚拟机处于关机状态
            </para>
          </listitem>
          <listitem>
            <para>
              如果虚拟机是从模板创建的, 那么创建虚拟机的模板也必须处于目的
              数据中心里, 或者导出虚拟机的时候选中 <keycap>Collapse 快照</keycap>
              选项.
            </para>
          </listitem>
        </itemizedlist>
        一旦虚拟机导出到导出域, 用户就可以开始把这些存在于导出域的虚拟机导入
        到目的数据中心里. 如果源数据中心和目的数据中心都在同一个 &OVIRT; 系统中,
        一旦完成导入操作, 用户可以从源数据中心把原来的数据删除.
      </para>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_10-3">
      <title>执行导入/导出资源</title>
      <formalpara><title>摘要</title>
      <para>
        以下步骤以配图的形式描述了导入虚拟资源到目的数据中心的步骤:
      </para>
      </formalpara>

      <procedure>
        <title>执行导入/导出资源</title>
        <step>
          <para>
            把导出域附加到源数据中心.
          </para>
          <!-- TODO: picture -->
        </step>
        <step>
          <para>
            把虚拟资源导出到导出域.
          </para>
          <!-- TODO: picture -->
        </step>
        <step>
          <para>
            从源数据中心分离导出域.
          </para>
          <!-- TODO: picture -->
        </step>
        <step>
          <para>
            附加导出域到目的数据中心.
          </para>
          <!-- TODO: picture -->
        </step>
        <step>
          <para>
            导入虚拟资源到目的数据中心
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟资源已经被导入到目的数据中心了.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_10-4">
      <title>导出虚拟机到导出存储域</title>
      <formalpara><title>摘要</title>
      <para>
        导出一个虚拟机到导出域以便该虚拟机可以导入到另一个数据中心. 在开始之间,
        要求系统至少有一个导出域附加到该虚拟机所在的数据中心.
      </para>
      </formalpara>

      <procedure>
        <title>导出虚拟机到导出存储域</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要
            的虚拟机. 确保该虚拟机处于<keycap>Down</keycap>状态.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>导出</keycap>打开<keycap>导出虚拟机</keycap>窗口.
          </para>
        </step>
        <step>
          <para>
            选择<keycap>强制覆盖</keycap>覆盖在该导出域中存在的相同虚拟机,
            选择<keycap>Collapse 快照</keycap>, 删除存储在该虚拟机内的快照点.
            如果该虚拟机是从模板创建的, 这个选项也将删除该虚拟机对模板的依赖.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>导出该虚拟机到导出域.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        将开始虚拟机的导出操作. 虚拟机的状态将变为 <keycap>Image Locked</keycap>.
        这个操作将持续一段时间, 具体的时间取决于你的虚拟机磁盘大小和硬件环境.
        用户可以通过<keycap>事件</keycap>标签来查看进度.
      </para>
      </formalpara>
      <para>
        导出完成后, 该虚拟机将会在该导出域的<keycap>VM Import</keycap> 标签上
        显示.
      </para>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_10-5">
      <title>导入虚拟机到目标数据中心</title>
      <formalpara><title>摘要</title>
      <para>
        前面已经将虚拟机导出到导出域里了. 在把虚拟机导入到新的数据中心之前, 该
        导出域比如先附加到目的数据中心上.
      </para>
      </formalpara>

      <procedure>
        <title>导入虚拟机到目标数据中心</title>
        <step>
          <para>
            点击存储标签, 列出所有存储域, 选择导出域, 注意该导出域必须处于激活
            状态.
          </para>
        </step>
        <step>
          <para>
            在详细面板种, 选择<keycap>虚拟机导入</keycap>, 列出可以导入的虚拟机.
          </para>
        </step>
        <step>
          <para>
            选择一个或者多个要导入的虚拟机, 点击<keycap>导入</keycap>, 打开
            <keycap>导入虚拟机</keycap>窗口.
            <!-- TODO: picture -->
          </para>
        </step>
        <step>
          <para>
            在下拉菜单中选择适当的<keycap>默认存储域</keycap>, <keycap>集群</keycap>,
            和<keycap>集群配额</keycap>.
          </para>
        </step>
        <step>
          <para>
            选中<keycap>Collapse 快照</keycap>可以删除虚拟机的快照点和对
            模板的依赖.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>导入虚拟机. 如果有重名的虚拟机, 一个窗口
            会打开提示用户怎么解决冲突, 如图:
          </para>
          <!-- TODO: picture -->
        </step>
        <step>
          <para>
            选择合适的选项解决冲突:
          <itemizedlist>
            <listitem>
              <para>
                选择<keycap>不要导入</keycap>
              </para>
            </listitem>
            <listitem>
              <para>
                选择<keycap>克隆</keycap>然后输入新的虚拟机名字
              </para>
            </listitem>
          </itemizedlist>
          或者选择<keycap>应用到全部</keycap>使用相同的前缀导入所有虚拟机.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>导入虚拟机.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        现在开始导入虚拟机了到目的数据中心了. 这个过程要话一段时间.
      </para>
      </formalpara>
    </section>
  </section>

  <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_11">
    <title>在主机之间迁移虚拟机</title>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_11-1">
      <title>什么是在线迁移？</title>
      <para>
        在线迁移将运行中的虚拟机的运行环境从一台主机转移到另一台主机, 这个过程
        不会中断虚拟机的运行.
      </para>
      <para>
        此外, 这个过程对使用该虚拟机的中断用户是透明的: 在迁移过程中, 虚拟机不会
        断电或者暂停, 应用程序不会发生任何的中断.
      </para>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_11-2">
      <title>在线迁移的需求</title>
      <para>
        在线迁移是指允许用户无缝的在主机之间移动虚拟机, 这使得 &OVIRT; 管理系统
        可以支持很多维护业务. 在使用在线迁移功能之前, 请确保 &OVIRT; 系统配置
        正确.
      </para>
      <para>
        要支持在线迁移, 目前需要满足以下条件:
        <itemizedlist>
          <listitem>
            <para>
              源主机和目的主机必须处于同一个集群中, 两个主机的 CPU 必选兼容.
            </para>
          </listitem>
          <listitem>
            <para>
              源主机和目的主机必须同事处于 <keycap>Up</keycap> 状态.
            </para>
          </listitem>
          <listitem>
            <para>
              源主机和目的主机必须对同样的虚拟网络和 VLANs 具有同样的访问权限.
            </para>
          </listitem>
          <listitem>
            <para>
              源主机和目的主机必须对虚拟机所在的存储域具有访问权限.
            </para>
          </listitem>
          <listitem>
            <para>
              目的主机必须具有足够的 CPU 兼容性来运行虚拟机.
            </para>
          </listitem>
          <listitem>
            <para>
              目的主机必须具有足够的空闲内存来运行虚拟机.
            </para>
          </listitem>
          <listitem>
            <para>
              在虚拟机的自定义属性中, 待迁移的虚拟机的 cache 设置不能为除
              <keycap>none</keycap> 之外的其他值.
            </para>
          </listitem>
        </itemizedlist>
      </para>
      <para>
        此外, 为了达到很好的性能, 在设置网络的时候, 存储和管理的网络必须分开,
        这样可以避免存储的网络流量和管理的网络都在一个网卡, 减轻网络负担. 在迁移
        的时候会在主机之间传送大量的数据.
      </para>
      <para>
        在线迁移的数据是在管理网络上流通的. 每一个迁移都限制了能使用的最大
        带宽(大约是 30MBPS), 能同时并发的迁移数也是有限制的. 如果没有这些
        限制的话, 一旦并发数很多, 可能会造成网络拥塞. 因此我们推荐在设置主机的
        网络的时候, 最好把用于存储, 显示, 虚拟机数据等的网络互相隔离开, 使得
        网络的利用率最大.
      </para>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_11-3">
      <title>自动迁移</title>
      <para>
        当主机处于维护模式的时候, &OVIRT; 系统会自动迁移该主机上运行的虚拟机
        到其他主机上. &OVIRT; 会根据主机的负载选择目的主机.
      </para>
      <para>
        在集群的策略起作用时, 比如负载均衡的条件被触发, 管理端会自动地根据策略
        开始虚拟机的迁移. 我们推荐用户根据自己的环境选择适合的集群策略, 用户
        也可以选择设置某个虚拟机不允许迁移.
      </para>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_11-4">
      <title>防止虚拟机自动迁移</title>
      <formalpara><title>摘要</title>
      <para>
        &OVIRT; 系统允许用户禁止虚拟机的自动迁移. 甚至用户可以指定虚拟机不能手动
        迁移, 即虚拟机只能运行在特定的虚拟机上.
      </para>
      </formalpara>
      <para>
        在虚拟机的高可用场景里, 有时需要虚拟机只能运行在一台虚拟机里, 不能被各种
        集群的策略迁移到其他主机.
      </para>

      <procedure>
        <title>防止虚拟机自动迁移</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要的
            虚拟机.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>编辑</keycap>打开<keycap>编辑虚拟机</keycap>窗口.
          </para>
          <!-- TODO: picture -->
        </step>
        <step>
          <para>
            点击<keycap>主机</keycap>标签.
          </para>
        </step>
        <step>
          <para>在<keycap>开始运行在</keycap>设置中, 选择运行在
          <keycap>集群里的任何主机</keycap>或者<keycap>专有的主机</keycap>.
          </para>
          <warning>
            <para>
              目前, 在 &OVIRT; 中, 指定虚拟机运行在特定主机或者指定虚拟机不允
              许迁移和虚拟机高可用是冲突的, 在这种情况下, 要使用虚拟机高可用, 用户
              可以通过第三方插件实现.
            </para>
          </warning>
        </step>
        <step>
          <para>
            在<keycap>迁移选项</keycap>中, 选择<keycap>不允许移植</keycap>,
            此时可以勾选<keycap>使用主机 CPU</keycap>来得到最佳的 CPU 性能.
          </para>
        </step>
        <step>
          <para>
            这个时候, 可以在<keycap>资源分配</keycap>上设置
            <keycap>CPU Pinning 拓扑结构</keycap>.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>完成设置.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟机的迁移设置将会被改变.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_11-5">
      <title>手动迁移虚拟机</title>
      <formalpara><title>摘要</title>
      <para>
        用户可以手动迁移运行中的虚拟机到集群中的另一台主机上. 在主机的负载很高
        的时候这是很有用的. 当主机出现问题或者主机被置为维护模式的时候, 系统会
        自动迁移虚拟机到其它主机上, 这时候用户不需要手动迁移. 无论怎样, 在线
        迁移虚拟机并不会中断虚拟机中运行的业务.
      </para>
      </formalpara>

      <procedure>
        <title>手动迁移虚拟机</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要
            的运行中的虚拟机.
          </para>
          <para>
            点击<keycap>移植</keycap>, 打开<keycap>移植虚拟机</keycap>窗口.
          </para>
        </step>
        <step>
          <para>
            选择<keycap>自动选择主机</keycap>或者<keycap>选择目的地主机</keycap>,
            并在下拉菜单中选择要迁移到的主机.
          </para>
          <note>
            <para>
              虚拟机迁移的目的主机和源主机都是在一个集群中. 如果选择了
              <keycap>自动选择主机</keycap>, 系统会根据集群中的负载均衡和电源管理设置为虚拟机
              选择目的主机.
            </para>
          </note>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>来开始迁移.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟机开始迁移, 一旦虚拟机成功完成迁移, 虚拟机列表中的该虚拟机的
        <keycap>主机</keycap>会更新为目的主机.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_11-6">
      <title>设置迁移的优先级</title>
      <formalpara><title>摘要</title>
      <para>
        &OVIRT; 管理系统一般会把虚拟机的迁移请求保存在一个队列里, 然后根据
        负载均衡和迁移策略的设置来决定何时发起迁移操作. 如果一个主机已经在某个
        迁移请求里, 那么下次在调度迁移策略的时候该主机不会被考虑在内, 知道该主机
        完成了他所在的迁移请求. 如果在迁移队里, 相应的主机能满足迁移的请求. 那么
        结合集群的迁移策略, 该迁移就能被发起.
      </para>
      </formalpara>

      <para>
        &OVIRT; 管理系统允许给迁移队列里的迁移请求设置优先级. 这样, 虚拟机
        的迁移请求就会根据优先级排序, 优先级高的请求会被先执行.
      </para>

      <note>
        <para>
          只能给虚拟服务器设置迁移优先级, 不能给虚拟桌面设置迁移优先级.
        </para>
      </note>

      <procedure>
        <title>设置迁移的优先级</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要
            的虚拟机.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>编辑</keycap>, 打开 <keycap>编辑虚拟机</keycap>窗口.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>高可用性</keycap>标签.
          </para>
        </step>
        <step>
          <para>
            根据需要在<keycap>运行/移植队列的优先级</keycap>里设置<keycap>低</keycap>,
            <keycap>中</keycap>或者<keycap>高</keycap>.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>保存设置.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟机的迁移优先级改变了.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_11-7">
      <title>取消虚拟机的在线迁移</title>
      <formalpara><title>摘要</title>
      <para>
        根据虚拟机的大小和硬件环境, 虚拟机的在线迁移可能花很多时间. &OVIRT;
        管理系统允许用户取消迁移.
      </para>
      </formalpara>

      <procedure>
        <title>取消虚拟机的在线迁移</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要
            的虚拟机, 这时虚拟机的状态为 <keycap>Migrating from</keycap>.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>取消移植</keycap>, 或者右键点击该虚拟机,
            选择<keycap>取消移植</keycap>.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        虚拟机的状态从 <keycap>Migrating from</keycap> 变为 <keycap>Up</keycap>.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_11-8">
      <title>高可用中自动迁移的事件和日志通知</title>
      <para>
        当高可用的策略生效时, 虚拟服务器会被自动迁移到其它主机. 该迁移的详细
        信息会在 <keycap>时间标签</keycap>上显示, 在 enging 的日志上也会有一条记录:
      </para>
      <example>
        <title>
          Example 8.1. Notification in the Events Tab of the Web Admin Portal
        </title>
        <para>
          Highly Available <keycap>Virtual_Machine_Name</keycap> failed.
          It will be restarted automatically.
        </para>
        <para>
          <keycap>Virtual_Machine_Name</keycap> was restarted on Host
          <keycap>Host_Name</keycap>
        </para>
      </example>

      <example>
        <title>
          Example 8.2. Notification in the Manager engine.log
        </title>
        <para>
          This log can be found on the Red Hat Enterprise Virtualization
          Manager at <keycap>/var/log/ovirt- engine/engine.log</keycap>:
        </para>
        <para>
          Failed to start Highly Available VM. Attempting to restart.
          VM Name: <keycap>Virtual_Machine_Name</keycap>,
          VM Id:<keycap>Virtual_Machine_ID_Number</keycap>
        </para>
      </example>
    </section>
  </section>

  <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_12">
    <title>利用虚拟机高可用的特性提高正常运行时间</title>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_12-1">
      <title>为什么使用高可用？</title>
      <para>
        当虚拟机需要运行重要的业务的时候, 用户可以设置虚拟机高可用, 让虚拟机
        的业务在主机出问题的时候不受到干扰.
      </para>
      <para>
        虚拟机高可用保证在以下情况下会重启虚拟机:
        <itemizedlist>
	      <listitem>
	        <para>
              由于硬件故障导致主机不可操作.
	        </para>
	      </listitem>
	      <listitem>
	        <para>
              用户把主机置为维护模式.
	        </para>
	      </listitem>
	      <listitem>
	        <para>
              由于主机与存储资源失去连接, 变为不可用.
	        </para>
	      </listitem>
        </itemizedlist>
        设置了高可用的虚拟机在发生上述情况下会自动重启, 重新在原理的主机或者
        新的主机上运行.
      </para>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_12-2">
      <title>什么是高可用？</title>
      <para>
        高可用就是虚拟机的相关资源等发生了问题, 使得虚拟机不能正常运行, 系统会
        重启该虚拟机使得它变为正常.
      </para>

      <para>
        虚拟机不能正常运行指的是, 虚拟机异常终止了, 而不是被用户在虚拟机内部关闭,
        或者被管理员在门户上关闭. 设置了高可用的虚拟机在发生上述情况下会自动重启,
        重新在原理的主机或者新的主机上运行.
      </para>

      <para>
        &OVIRT; 管理系统会一直监控主机和存储还有其它硬件是否发生故障. 如果相关
        资源发生了故障, 设置了高可用的虚拟机在发生上述情况下会自动重启,
        重新在原理的主机或者新的主机上运行.
      </para>

      <para>
        如果设置了高可用, 服务终端造成的影响就减为最小了, 因为虚拟机会在数十秒
        之内重启, 这个过程不需要用户的干涉. 通过在资源利用率低的主机上重启虚拟机,
        高可用同时会保证整个集群资源的均衡, 这样也保证了集群中一直有足够的资源来
        使得虚拟机处于运行状态.
      </para>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_12-3">
      <title>高可用的注意事项</title>
      <para>
        配置高可用的时候, 主机配置好电源管理. 当虚拟机配置和高可用的时候,
        当运行在其上的主机处于不可操作状态时, 该虚拟机将会在集群中另外一台
        主机上运行. 高可用需要满足以下条件:
        <itemizedlist>
	      <listitem>
	        <para>
              必须在运行虚拟机的主机上配置电源管理.
	        </para>
	      </listitem>
	      <listitem>
	        <para>
              运行虚拟机的主机所在的集群必须有的其它可用主机.
	        </para>
	      </listitem>
	      <listitem>
	        <para>
              目的主机必须处于运行状态.
	        </para>
	      </listitem>
	      <listitem>
	        <para>
              源主机和目的主机必须具有对虚拟机磁盘所处的存储的相同的访问权限.
	        </para>
	      </listitem>
          <listitem>
            <para>
              目的主机必须具有足够的 CPU 兼容性来运行虚拟机.
            </para>
          </listitem>
          <listitem>
            <para>
              目的主机必须具有足够的空闲内存来运行虚拟机.
            </para>
          </listitem>
          <listitem>
            <para>
              在虚拟机的自定义属性中, 待迁移的虚拟机的 cache 设置不能为除
              <keycap>none</keycap> 之外的其他值.
            </para>
          </listitem>
        </itemizedlist>
      </para>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_12-4">
      <title>配置高可用虚拟机</title>
      <formalpara><title>摘要</title>
      <para>
        在 &OVIRT; 管理系统中, 虚拟机的高可用必须针对每一个虚拟服务器设置.
      <note>
        <para>
          只能给虚拟服务器设置迁移优先级, 不能给虚拟桌面设置迁移优先级.
        </para>
      </note>
      </para>
      </formalpara>

      <procedure>
        <title>设置迁移的优先级</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要
            的虚拟机.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>编辑</keycap>, 打开 <keycap>编辑虚拟机</keycap>窗口.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>高可用性</keycap>标签.
            <!-- TODO: picture -->
          </para>
        </step>
        <step>
          <para>
            选择<keycap>高可用</keycap>, 设置启用虚拟服务器的高可用.
          </para>
        </step>
        <step>
          <para>
            根据需要在<keycap>运行/移植队列的优先级</keycap>里设置<keycap>低</keycap>,
            <keycap>中</keycap>或者<keycap>高</keycap>. 迁移开始时, 一个迁移
            的请求会被加入到迁移队列中, 具有高优先级的请求会先被处理.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>保存设置.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        已经给虚拟机配置好了高可用设置. 在常规显示上可以看到设置的结果.
      </para>
      </formalpara>
    </section>
  </section>

  <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_13">
    <title>其它虚拟机任务</title>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_13-1">
      <title>在管理员门户中为虚拟机激活SAP监控</title>
      <formalpara><title>摘要</title>
      <para>
        在虚拟机中启用 SAP 监控.
      </para>
      </formalpara>

      <procedure>
        <title>在管理员门户中为虚拟机激活SAP监控</title>
        <step>
          <para>
            点击<keycap>虚拟机</keycap>标签列出系统中的所有虚拟机, 找到需要
            的虚拟机, 确保虚拟机处于关机状态.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>编辑</keycap>, 打开<keycap>编辑虚拟机</keycap>窗口.
          </para>
        </step>
        <step>
          <para>
            选择<keycap>自定义属性</keycap>.
          </para>
        </step>
        <step>
          <para>
            在下拉框里选择<keycap>sap_agent</keycap>. 确保值是 <keycap>true</keycap>.
          </para>
        </step>
        <step>
          <para>
            点击<keycap>确定</keycap>保存.
          </para>
        </step>
      </procedure>

      <formalpara><title>结果</title>
      <para>
        成功为虚拟机设置了 SAP.
      </para>
      </formalpara>
    </section>

    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_13-2">
      <title>配置CentOS5.4或更高版本的客户机操作系统使用SPICE</title>
      <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_13-2-1">
        <title>使用SPICE</title>
        <para>
          SPICE 是一个专注于虚拟化的远程显示协议, 用户可以用它来查看虚拟桌面和
          虚拟服务器. SPICE 能给用户提供高质量的用户体验, 很低的 CPU 占用率,
          还支持高质量视频.
        </para>
        <para>
          在 Linux 虚拟机中使用 SPICE 显著的改善鼠标的滑动体验. 为了使用 SPICE,
          虚拟机里面的 X-Windows 需要二外的 qxl 驱动. 在 Centos 5.4 及其以上
          版本, qxl 驱动是默认提供的. 旧的 centos 版本没有提供这个驱动. 在虚拟机
          上安装 SPICE 能显示改善用户的图形体验.
        </para>
      </section>
      <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_13-2-2">
        <title>为虚拟机安装qxl驱动</title>
        <formalpara><title>摘要</title>
        <para>
          下列步骤描述了在 Centos 5.4 以及以上版本中安装 qxl 驱动的方法.
        </para>
        </formalpara>

        <procedure>
          <title>为虚拟机安装qxl驱动</title>
          <step>
            <para>
              登陆到 Centos 虚拟机中.
            </para>
          </step>
          <step>
            <para>
              打开终端
            </para>
          </step>
          <step>
            <para>
              用 root 用户使用以下命令安装
              <programlisting language="Bash">
# yum install xorg-x11-drv-qxl
              </programlisting>
            </para>
          </step>
        </procedure>

        <formalpara><title>结果</title>
        <para>
          qxl 驱动已经安装好了, 现在可以配置了.
        </para>
        </formalpara>
      </section>
      <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_13-2-3">
        <title>为虚拟机配置qxl驱动</title>
        <formalpara><title>摘要</title>
        <para>
          用户可以使用下面的任何一种步骤来配置 qxl 驱动
        </para>
        </formalpara>

        <procedure>
          <title>使用gnome为虚拟机配置qxl驱动</title>
          <step>
            <para>
              点击<keycap>系统</keycap>.
            </para>
          </step>
          <step>
            <para>
              点击<keycap>点击管理</keycap>.
            </para>
          </step>
          <step>
            <para>
              点击<keycap>显示</keycap>.
            </para>
          </step>
          <step>
            <para>
              点击<keycap>硬件</keycap>.
            </para>
          </step>
          <step>
            <para>
              点击<keycap>视频卡配置</keycap>.
            </para>
          </step>
          <step>
            <para>
              选择 <keycap>qxl</keycap>, 点击 <keycap>确定</keycap>.
            </para>
          </step>
          <step>
            <para>
              重新登陆 X-Windows.
            </para>
          </step>
        </procedure>

        <procedure>
          <title>使用命令行为虚拟机配置qxl驱动</title>
          <step>
            <para>
              备份 <keycap>/etc/X11/xorg.conf</keycap>:
              <programlisting language="Bash">
# cp /etc/X11/xorg.conf /etc/X11/xorg.conf.$$.backup
              </programlisting>
            </para>
          </step>
          <step>
            <para>
              改变<keycap>/etc/X11/xorg.conf</keycap>相关内容为以下:
              <programlisting language="Bash">
Section "Device"
Identifier "Videocard0"
Driver "qxl" Endsection
              </programlisting>
            </para>
          </step>
          <step>
            <para>
            </para>
          </step>
        </procedure>

        <formalpara><title>结果</title>
        <para>
          qxl 驱动已经配置好, 现在可以使用了.
        </para>
        </formalpara>
      </section>
      <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_13-2-4">
        <title>为虚拟机配置键盘和鼠标,以使SPICE可工作</title>
        <formalpara><title>摘要</title>
        <para>
          编辑 <keycap>/etc/X11/xorg.conf</keycap>, 来启动 spice 的 tablet 设备.
        </para>
        </formalpara>

        <procedure>
          <title>为虚拟机配置键盘和鼠标,以使SPICE可工作</title>
          <step>
            <para>
              确保 tablet 设备在系统中被识别出来.
              <programlisting language="Bash">
# /sbin/lsusb -v | grep 'QEMU USB Tablet'
              </programlisting>
              如果没有任何输出的话, 没必要配置 tablet 设备了.
            </para>
          </step>
          <step>
            <para>
              备份 <keycap>/etc/X11/xorg.conf</keycap>:
              <programlisting language="Bash">
# cp /etc/X11/xorg.conf /etc/X11/xorg.conf.$$.backup
              </programlisting>
            </para>
          </step>
          <step>
            <para>
              修改 /etc/X11/xorg.conf 的相关内容为:.
              <screen>
Section "ServerLayout"
Identifier Screen InputDevice InputDevice InputDevice EndSection
"single head configuration" 0 "Screen0" 0 0
"Keyboard0" "CoreKeyboard" "Tablet" "SendCoreEvents" "Mouse" "CorePointer"
Section "InputDevice" Identifier "Mouse"
Driver #Option #Option EndSection
"void"
"Device" "/dev/input/mice" "Emulate3Buttons" "yes"
Section "InputDevice"
Identifier "Tablet"
Driver "evdev"
Option "Device" "/dev/input/event2" Option "CorePointer" "true"
EndSection
              </screen>
            </para>
          </step>
          <step>
            <para>
              重新登陆 X-Windows.
            </para>
          </step>
        </procedure>

        <formalpara><title>结果</title>
        <para>
          已经在虚拟机中启用了 tablet 设备了.
        </para>
        </formalpara>
      </section>
    </section>
    <section id="sect-Documents-administrator-guide-Chapter-virtual-machine_Section_13-3">
      <title>KVM虚拟机的时间同步</title>
      <!-- TODO: -->
      <para>
      </para>
    </section>
  </section>
</chapter>

